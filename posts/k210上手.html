<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2018-10-30">

<title>k210环境搭建_Linux – Zheng’s Notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../assets/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-8b4baf804e461d9b72633f0de59a0cac.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-7072389654d23eff08f359f9aa0d1ee7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Zheng’s Notes</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#安装交叉编译器" id="toc-安装交叉编译器" class="nav-link active" data-scroll-target="#安装交叉编译器">安装交叉编译器</a></li>
  <li><a href="#安装openbcd调试" id="toc-安装openbcd调试" class="nav-link" data-scroll-target="#安装openbcd调试">安装openbcd调试</a></li>
  <li><a href="#开始编译" id="toc-开始编译" class="nav-link" data-scroll-target="#开始编译">开始编译</a></li>
  <li><a href="#烧录程序" id="toc-烧录程序" class="nav-link" data-scroll-target="#烧录程序">烧录程序</a></li>
  <li><a href="#运行效果" id="toc-运行效果" class="nav-link" data-scroll-target="#运行效果">运行效果</a></li>
  <li><a href="#附件" id="toc-附件" class="nav-link" data-scroll-target="#附件">附件</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">k210环境搭建_Linux</h1>
  <div class="quarto-categories">
    <div class="quarto-category">边缘计算</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 30, 2018</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<ol type="1">
<li><p>首先我使用的Deepin15.6系统,我拿到的板子是绿色的原版</p></li>
<li><p>我们找到<a href="https://kendryte.com/#">官网</a>,进入其中的<a href="https://kendryte.com/downloads/">资源下载</a> <!--more--></p></li>
<li><p>我首先下载<code>Kendryte KD233 Board Schematic V01</code>原理图。</p></li>
<li><p>再下载一个<code>Kendryte K210 Standalone SDK</code>裸机sdk。</p></li>
<li><p>当然还需要一个工具链<code>Kendryte OpenOCD for Ubuntu x86_64</code></p></li>
<li><p>以及交叉编译器<code>RISC-V 64bit toolchain for Kendryte K210_ubuntu_amd64</code></p></li>
</ol>
<section id="安装交叉编译器" class="level1">
<h1>安装交叉编译器</h1>
<p>之前我们下载了<code>RISC-V 64bit toolchain for Kendryte K210_ubuntu_amd64</code>交叉编译器。现在我们首先需要对他进行安装。</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  ~ cd ~/Downloads/         <span class="co"># 进入你下载到文件的目录</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  Downloads sudo tar <span class="at">-xvf</span> kendryte-toolchain.tar.gz <span class="at">-C</span> /opt/   <span class="co"># 使用-C参数将解压出来文件放入/opt目录中，大家自己随意</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  Downloads cd /opt/kendryte-toolchain/bin         <span class="co"># 解压完成进入目录</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  bin realpath .                                   <span class="co"># 获取当前目录路径，为了添加环境变量</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">/opt/kendryte-toolchain/bin</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  bin sudo vi /etc/profile                         <span class="co"># 编辑profile文件，添加环境变量</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="va">PATH</span><span class="op">=</span><span class="st">"</span><span class="va">$PATH</span><span class="st">:/opt/kendryte-toolchain/bin"</span>            <span class="co">#  在文件末尾添加上编译器可执行文件目录</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  bin source /etc/profile                          <span class="co"># 同步环境变量以生效</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> riscv64-unknown-elf-                               <span class="co"># 输入riscv64 之后按tab键 出现一大串说明是安装成功了</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="ex">riscv64-unknown-elf-addr2line</span>   riscv64-unknown-elf-gcov-tool </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="ex">riscv64-unknown-elf-ar</span>          riscv64-unknown-elf-gdb       </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="ex">riscv64-unknown-elf-as</span>          riscv64-unknown-elf-gprof     </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="ex">riscv64-unknown-elf-c++</span>         riscv64-unknown-elf-ld        </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="ex">riscv64-unknown-elf-c++filt</span>     riscv64-unknown-elf-ld.bfd    </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="ex">riscv64-unknown-elf-cpp</span>         riscv64-unknown-elf-nm        </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="ex">riscv64-unknown-elf-elfedit</span>     riscv64-unknown-elf-objcopy   </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="ex">riscv64-unknown-elf-g++</span>         riscv64-unknown-elf-objdump   </span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="ex">riscv64-unknown-elf-gcc</span>         riscv64-unknown-elf-ranlib    </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="ex">riscv64-unknown-elf-gcc-7.2.0</span>   riscv64-unknown-elf-readelf   </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="ex">riscv64-unknown-elf-gcc-ar</span>      riscv64-unknown-elf-run       </span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="ex">riscv64-unknown-elf-gcc-nm</span>      riscv64-unknown-elf-size      </span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="ex">riscv64-unknown-elf-gcc-ranlib</span>  riscv64-unknown-elf-strings   </span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="ex">riscv64-unknown-elf-gcov</span>        riscv64-unknown-elf-strip     </span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="ex">riscv64-unknown-elf-gcov-dump</span>       </span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> riscv64-unknown-elf-gcc <span class="at">-v</span>                        <span class="co"># deepin下执行也是有效果的</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="ex">Using</span> built-in specs.</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="va">COLLECT_GCC</span><span class="op">=</span>riscv64-unknown-elf-gcc</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="va">COLLECT_LTO_WRAPPER</span><span class="op">=</span>/opt/kendryte-toolchain/bin/../libexec/gcc/riscv64-unknown-elf/7.2.0/lto-wrapper</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="ex">Target:</span> riscv64-unknown-elf</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="ex">Configured</span> with: /opt/toolchain/riscv-gnu-toolchain/riscv-gcc/configure <span class="at">--target</span><span class="op">=</span>riscv64-unknown-elf <span class="at">--prefix</span><span class="op">=</span>/usr/local <span class="at">--disable-shared</span> <span class="at">--disable-threads</span> <span class="at">--enable-languages</span><span class="op">=</span>c,c++ <span class="at">--with-system-zlib</span> <span class="at">--enable-tls</span> <span class="at">--with-newlib</span> <span class="at">--with-sysroot</span><span class="op">=</span>/usr/local/riscv64-unknown-elf <span class="at">--with-native-system-header-dir</span><span class="op">=</span>/include <span class="at">--disable-libmudflap</span> <span class="at">--disable-libssp</span> <span class="at">--disable-libquadmath</span> <span class="at">--disable-libgomp</span> <span class="at">--disable-nls</span> <span class="at">--src</span><span class="op">=</span>.././riscv-gcc <span class="at">--enable-checking</span><span class="op">=</span>yes <span class="at">--disable-multilib</span> <span class="at">--with-abi</span><span class="op">=</span>lp64d <span class="at">--with-arch</span><span class="op">=</span>rv64imafdc <span class="st">'CFLAGS_FOR_TARGET=-Os  -mcmodel=medany'</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="ex">Thread</span> model: single</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> version 7.2.0 <span class="er">(</span><span class="ex">GCC</span><span class="kw">)</span> </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="安装openbcd调试" class="level1">
<h1>安装openbcd调试</h1>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  ~ mkdir Kendryte_K210    <span class="co"># 首先我在家目录下建立了一个文件用于存放本开发版相关资料</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  ~ cd Downloads           <span class="co"># 进入下载目录</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  Downloads tar <span class="at">-xvf</span> kendryte-openocd-0.1.3-ubuntu64.tar.gz <span class="at">-C</span> ~/Kendryte_K210/   <span class="co"># 解压openbcd到之前建立的文件夹</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  Downloads cd ~/Kendryte_K210/kendryte-openocd/ </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  kendryte-openocd sudo apt install libusb-dev <span class="at">-y</span>          <span class="co"># 根据openbcd的readme文件，先安装libusb库</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  kendryte-openocd ./bin/openocd <span class="at">-v</span>                        <span class="co"># 运行此命令 输出两行如下，说明可以使用</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Kendryte</span> Open On-Chip Debugger For RISC-V v0.1.3 <span class="er">(</span><span class="ex">20180912</span><span class="kw">)</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Licensed</span> under GNU GPL v2</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="开始编译" class="level1">
<h1>开始编译</h1>
<ol type="1">
<li><p><strong>首先我使用的vscode写代码，所以首先使用vscode打开工程目录</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  ~ code Kendryte_K210/kendryte-standalone-sdk-0.5.0  <span class="co"># 启动vscode</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./k210上手/1.png" class="img-fluid figure-img"></p>
<figcaption>开启图片</figcaption>
</figure>
</div></li>
<li><p><strong>配置c++插件</strong></p>
<p>可以看到我的图片里面有绿色波浪线，说明我的代码存在问题，这是由于没有配置好c++插件导致找不到头文件的问题。所以修改左上方的<code>.vscode/c_cpp_properties</code>为：</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="dt">"configurations"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"Linux"</span><span class="fu">,</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"includePath"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"${workspaceFolder}/**"</span><span class="ot">,</span>   </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"${workspaceFolder}/lib/bsp/include"</span><span class="ot">,</span>  </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"${workspaceFolder}/lib/drivers/include"</span><span class="ot">,</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"/opt/kendryte-toolchain/riscv64-unknown-elf/include"</span>  <span class="er">//依据自己编译器安装位置修改</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"defines"</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"compilerPath"</span><span class="fu">:</span> <span class="st">"/opt/kendryte-toolchain/bin/riscv64-unknown-elf-gcc"</span><span class="fu">,</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"cStandard"</span><span class="fu">:</span> <span class="st">"c11"</span><span class="fu">,</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"cppStandard"</span><span class="fu">:</span> <span class="st">"c++17"</span><span class="fu">,</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"intelliSenseMode"</span><span class="fu">:</span> <span class="st">"clang-x64"</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="dt">"version"</span><span class="fu">:</span> <span class="dv">4</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>配置成功后如图，就没有错误信息了。 <img src="./k210上手/2.png" class="img-fluid" alt="配置成功"></p></li>
<li><p><strong>创建build目录</strong></p>
<p>打开终端运行：</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  kendryte-standalone-sdk-0.5.0 mkdir build</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  kendryte-standalone-sdk-0.5.0 cd build</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./k210上手/3.png" class="img-fluid figure-img"></p>
<figcaption>配置成功</figcaption>
</figure>
</div></li>
<li><p><strong>生成对应工程的Makefile</strong> 因为我们已经配置过了编译器的环境变量，所以现在我们使用如下命令生成<code>Makefile</code></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  build cmake .. <span class="at">-DPROJ</span><span class="op">=</span>hello_world</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">PROJ</span> = hello_world</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="ex">--</span> Check for RISCV toolchain ...</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="ex">--</span> Using /opt/kendryte-toolchain/bin RISCV toolchain</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="va">SOURCE_FILES</span><span class="op">=</span>/home/zqh/Kendryte_K210/kendryte-standalone-sdk-0.5.0/src/hello_world/main.c</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Project:</span> hello_world  LIST_FILE=/home/zqh/Kendryte_K210/kendryte-standalone-sdk-0.5.0/cmake/executable.cmake  TOOLCHAIN=/opt/kendryte-toolchain/bin</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="va">KENDRYTE_IDE</span><span class="op">=</span>  <span class="va">BUILDING_SDK</span><span class="op">=</span>yes</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="va">CMAKE_BUILD_TYPE</span><span class="op">=</span>Debug  <span class="va">CMAKE_C_COMPILER</span><span class="op">=</span>/opt/kendryte-toolchain/bin/riscv64-unknown-elf-gcc</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="va">CMAKE_CXX_COMPILER</span><span class="op">=</span>/opt/kendryte-toolchain/bin/riscv64-unknown-elf-g++</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="va">CMAKE_LINKER</span><span class="op">=</span>/opt/kendryte-toolchain/bin/riscv64-unknown-elf-ld</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="va">CMAKE_OBJCOPY</span><span class="op">=</span>/opt/kendryte-toolchain/bin/riscv64-unknown-elf-objcopy</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="va">CMAKE_OBJDUMP</span><span class="op">=</span>/opt/kendryte-toolchain/bin/riscv64-unknown-elf-objdump</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="va">CMAKE_MAKE_PROGRAM</span><span class="op">=</span>/usr/bin/make</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="va">CMAKE_C_FLAGS</span><span class="op">=</span> <span class="ex">-mcmodel=medany</span> <span class="at">-fno-common</span> <span class="at">-ffunction-sections</span> <span class="at">-fdata-sections</span> <span class="at">-fstrict-volatile-bitfields</span> <span class="at">-fno-zero-initialized-in-bss</span> <span class="at">-Os</span> <span class="at">-ggdb</span> <span class="at">-std</span><span class="op">=</span>gnu11 <span class="at">-Wno-pointer-to-int-cast</span> <span class="at">-Wall</span> <span class="at">-Werror</span><span class="op">=</span>all <span class="at">-Wno-error</span><span class="op">=</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="ex">unused-function</span> <span class="at">-Wno-error</span><span class="op">=</span>unused-but-set-variable <span class="at">-Wno-error</span><span class="op">=</span>unused-variable <span class="at">-Wno-error</span><span class="op">=</span>deprecated-declarations <span class="at">-Wextra</span> <span class="at">-Werror</span><span class="op">=</span>frame-larger-than=65536 <span class="at">-Wno-unused-parameter</span> <span class="at">-Wno-sign-compare</span> <span class="at">-Wno-error</span><span class="op">=</span>missing-b</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="ex">races</span> <span class="at">-Wno-error</span><span class="op">=</span>return-type <span class="at">-Wno-error</span><span class="op">=</span>pointer-sign <span class="at">-Wno-missing-braces</span> <span class="at">-Wno-strict-aliasing</span> <span class="at">-Wno-implicit-fallthrough</span> <span class="at">-Wno-missing-field-initializers</span> <span class="at">-Wno-old-style-declaration</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="va">CMAKE_CXX_FLAGS</span><span class="op">=</span> <span class="ex">-mcmodel=medany</span> <span class="at">-fno-common</span> <span class="at">-ffunction-sections</span> <span class="at">-fdata-sections</span> <span class="at">-fstrict-volatile-bitfields</span> <span class="at">-fno-zero-initialized-in-bss</span> <span class="at">-Os</span> <span class="at">-ggdb</span> <span class="at">-std</span><span class="op">=</span>gnu++17 <span class="at">-Wall</span> <span class="at">-Werror</span><span class="op">=</span>all <span class="at">-Wno-error</span><span class="op">=</span>unused-function <span class="at">-Wno-</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="va">error</span><span class="op">=</span>unused-but-set-variable <span class="ex">-Wno-error=unused-variable</span> <span class="at">-Wno-error</span><span class="op">=</span>deprecated-declarations <span class="at">-Wextra</span> <span class="at">-Werror</span><span class="op">=</span>frame-larger-than=65536 <span class="at">-Wno-unused-parameter</span> <span class="at">-Wno-sign-compare</span> <span class="at">-Wno-error</span><span class="op">=</span>missing-braces <span class="at">-Wno-error</span><span class="op">=</span>retu</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="ex">rn-type</span> <span class="at">-Wno-error</span><span class="op">=</span>pointer-sign <span class="at">-Wno-missing-braces</span> <span class="at">-Wno-strict-aliasing</span> <span class="at">-Wno-implicit-fallthrough</span> <span class="at">-Wno-missing-field-initializers</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="va">LDFLAGS</span><span class="op">=</span> <span class="ex">-nostartfiles</span> <span class="at">-static</span> <span class="at">-Wl,--gc-sections</span> <span class="at">-Wl,-static</span> <span class="at">-Wl,--start-group</span> <span class="at">-Wl,--whole-archive</span> <span class="at">-Wl,--no-whole-archive</span> <span class="at">-Wl,--end-group</span> <span class="at">-Wl,-EL</span> <span class="at">-T</span> /home/zqh/Kendryte_K210/kendryte-standalone-sdk-0.5.0/lds/kend</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="ex">ryte.ld</span>  </span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="va">CMAKE_BINARY_DIR</span><span class="op">=</span>/home/zqh/Kendryte_K210/kendryte-standalone-sdk-0.5.0/build</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="ex">Makefile</span> created.</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>出现<code>Makefile created.</code>说明我们已经可以开始编译咯</p></li>
<li><p><strong>编译工程</strong></p>
<p>依旧是在那个目录下，执行<code>make</code>命令。</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  build make</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  2%] Building C <span class="er">object</span> <span class="ex">lib/CMakeFiles/kendryte.dir/bsp/entry.c.obj</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  5%] Building C <span class="er">object</span> <span class="ex">lib/CMakeFiles/kendryte.dir/bsp/entry_user.c.obj</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  8%] Building C <span class="er">object</span> <span class="ex">lib/CMakeFiles/kendryte.dir/bsp/interrupt.c.obj</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> 11%] Building C <span class="er">object</span> <span class="ex">lib/CMakeFiles/kendryte.dir/bsp/printf.c.obj</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> 14%] Building C <span class="er">object</span> <span class="ex">lib/CMakeFiles/kendryte.dir/bsp/sleep.c.obj</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> 17%] Building C <span class="er">object</span> <span class="ex">lib/CMakeFiles/kendryte.dir/bsp/syscalls.c.obj</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> 20%] Building C <span class="er">object</span> <span class="ex">lib/CMakeFiles/kendryte.dir/drivers/aes.c.obj</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> 23%] Building C <span class="er">object</span> <span class="ex">lib/CMakeFiles/kendryte.dir/drivers/clint.c.obj</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> 26%] Building C <span class="er">object</span> <span class="ex">lib/CMakeFiles/kendryte.dir/drivers/common.c.obj</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> 29%] Building C <span class="er">object</span> <span class="ex">lib/CMakeFiles/kendryte.dir/drivers/dmac.c.obj</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> 32%] Building C <span class="er">object</span> <span class="ex">lib/CMakeFiles/kendryte.dir/drivers/dvp.c.obj</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> 35%] Building C <span class="er">object</span> <span class="ex">lib/CMakeFiles/kendryte.dir/drivers/fft.c.obj</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="ex">In</span> file included from /home/zqh/Kendryte_K210/kendryte-standalone-sdk-0.5.0/lib/drivers/fft.c:15:0:</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="ex">/home/zqh/Kendryte_K210/kendryte-standalone-sdk-0.5.0/lib/drivers/include/fft.h:222:29:</span> error: unknown type name <span class="st">'dmac_channel_number_t'</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="ex">void</span> fft_complex_uint16_dma<span class="er">(</span><span class="ex">dmac_channel_number_t</span> dma_send_channel_num,</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>                            <span class="ex">^~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="ex">/home/zqh/Kendryte_K210/kendryte-standalone-sdk-0.5.0/lib/drivers/include/fft.h:223:29:</span> error: unknown type name <span class="st">'dmac_channel_number_t'</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>                            <span class="ex">dmac_channel_number_t</span> dma_receive_channel_num,</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>                            <span class="ex">^~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="ex">/home/zqh/Kendryte_K210/kendryte-standalone-sdk-0.5.0/lib/drivers/include/fft.h:225:52:</span> error: unknown type name <span class="st">'size_t'</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>                            <span class="ex">const</span> uint64_t <span class="pp">*</span>input, size_t point_num,</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>                                                    <span class="ex">^~~~~~</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="va">make</span><span class="op">[</span><span class="dv">2</span><span class="op">]</span><span class="ex">:</span> <span class="pp">***</span> <span class="pp">[</span><span class="ss">lib/CMakeFiles/kendryte.dir/build.make:206：lib/CMakeFiles/kendryte.dir/drivers/fft.c.obj</span><span class="pp">]</span> 错误 1</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="va">make</span><span class="op">[</span><span class="dv">1</span><span class="op">]</span><span class="ex">:</span> <span class="pp">***</span> <span class="pp">[</span><span class="ss">CMakeFiles/Makefile2:123：lib/CMakeFiles/kendryte.dir/all</span><span class="pp">]</span> 错误 2</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="ex">make:</span> <span class="pp">***</span> <span class="pp">[</span><span class="ss">Makefile:84：all</span><span class="pp">]</span> 错误 2</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>这里我使用的sdk是<code>kendryte-standalone-sdk-0.5.0</code>，可能这个工程还是有点问题的。</p></li>
<li><p><strong>问题解决</strong></p>
<p>这里看到错误提示为<code>dmac_channel_number_t</code>未定义，我进入<code>fft.h</code>查看了一下，发现这个文件可能少加了个头文件。所以在<code>/kendryte-standalone-sdk-0.5.0/lib/drivers/include/fft.h</code>中添加一行 <code>#include "dmac.h"</code></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./k210上手/4.png" class="img-fluid figure-img"></p>
<figcaption>修改</figcaption>
</figure>
</div></li>
<li><p><strong>编译成功</strong></p>
<p>现在重新运行<code>make</code>命令即可编译成功。 <img src="./k210上手/5.png" class="img-fluid" alt="编译成功"></p></li>
</ol>
</section>
<section id="烧录程序" class="level1">
<h1>烧录程序</h1>
<p>此芯片暂时我只看到通过串口烧录程序的，并且由于我是linux系统，linux下串口烧录程序的文件在官网暂时没有。所以我在qq群中找到Python下载脚本。脚本内容放在最后，大家复制即可。 将脚本保存为<code>isp_auto.revA.02.py</code>后执行如下：</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  build python3 isp_auto.revA.02.py <span class="at">-p</span> /dev/ttyUSB0 <span class="at">-b</span> 115200 hello_world.bin</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">[INFO]</span> COM Port Selected Manually:  /dev/ttyUSB0</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="ex">[INFO]</span> Selected Baudrate:  115200</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="ex">[INFO]</span> Trying to Enter the ISP Mode...</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="ex">[INFO]</span> Greeting Message Detected, Start Downloading ISP</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Downloading</span> ISP: <span class="kw">|</span><span class="ex">██████████████████████████████████████████████████</span><span class="kw">|</span> <span class="ex">100.0%</span> Complete</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="ex">[INFO]</span> Booting From 0x80000000</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="ex">[INFO]</span> Wait For 1sec for ISP to Boot</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="ex">[INFO]</span> Boot to Flashmode Successfully</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="ex">[INFO]</span> Selected Flash:  On-Board</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="ex">Downloading</span> Program: <span class="kw">|</span><span class="ex">██████████████████████████████████████████████████</span><span class="kw">|</span> <span class="ex">100.0%</span> Complete</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="ex">[INFO]</span> Rebooting...</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>提示</strong> 如果是黑色板子，那么没有问题，但是我这个是绿色板子初代版本，自动下载电路没有完善，所以需要手动拉低boot。 我们需要将IO16的跳线帽拔掉，并且在靠近芯片那一端接一根线出来连接到GND，<strong>然后按一下<code>RESET</code>！！</strong>，进入isp模式，<strong>才可以下载程序</strong>。 如图所示： <img src="./k210上手/6.png" class="img-fluid" alt="手动下载"></p>
</section>
<section id="运行效果" class="level1">
<h1>运行效果</h1>
<p>现在我们打开串口调试助手，重启板子，就可以看到串口输出啦～～ <img src="./k210上手/7.png" class="img-fluid" alt="效果"></p>
</section>
<section id="附件" class="level1">
<h1>附件</h1>
<p><code>isp_auto.revA.02.py</code></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!env python3</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>BASH_TIPS <span class="op">=</span> <span class="bu">dict</span>(NORMAL<span class="op">=</span><span class="st">'</span><span class="ch">\033</span><span class="st">[0m'</span>,BOLD<span class="op">=</span><span class="st">'</span><span class="ch">\033</span><span class="st">[1m'</span>,DIM<span class="op">=</span><span class="st">'</span><span class="ch">\033</span><span class="st">[2m'</span>,UNDERLINE<span class="op">=</span><span class="st">'</span><span class="ch">\033</span><span class="st">[4m'</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                    DEFAULT<span class="op">=</span><span class="st">'</span><span class="ch">\033</span><span class="st">[39'</span>, RED<span class="op">=</span><span class="st">'</span><span class="ch">\033</span><span class="st">[31m'</span>, YELLOW<span class="op">=</span><span class="st">'</span><span class="ch">\033</span><span class="st">[33m'</span>, GREEN<span class="op">=</span><span class="st">'</span><span class="ch">\033</span><span class="st">[32m'</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                    BG_DEFAULT<span class="op">=</span><span class="st">'</span><span class="ch">\033</span><span class="st">[49m'</span>, BG_WHITE<span class="op">=</span><span class="st">'</span><span class="ch">\033</span><span class="st">[107m'</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>ERROR_MSG   <span class="op">=</span> BASH_TIPS[<span class="st">'RED'</span>]<span class="op">+</span>BASH_TIPS[<span class="st">'BOLD'</span>]<span class="op">+</span><span class="st">'[ERROR]'</span><span class="op">+</span>BASH_TIPS[<span class="st">'NORMAL'</span>]</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>WARN_MSG    <span class="op">=</span> BASH_TIPS[<span class="st">'YELLOW'</span>]<span class="op">+</span>BASH_TIPS[<span class="st">'BOLD'</span>]<span class="op">+</span><span class="st">'[WARN]'</span><span class="op">+</span>BASH_TIPS[<span class="st">'NORMAL'</span>]</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>INFO_MSG    <span class="op">=</span> BASH_TIPS[<span class="st">'GREEN'</span>]<span class="op">+</span>BASH_TIPS[<span class="st">'BOLD'</span>]<span class="op">+</span><span class="st">'[INFO]'</span><span class="op">+</span>BASH_TIPS[<span class="st">'NORMAL'</span>]</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>VID_LIST_FOR_AUTO_LOOKUP <span class="op">=</span> <span class="st">"(1A86)|(0403)|(067B)|(10C4)"</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">#                            WCH    FTDI    PL     CL</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>timeout <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="pp">TimeoutError</span>(<span class="pp">Exception</span>): <span class="cf">pass</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zlib</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> serial</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> serial.tools.list_ports</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ImportError</span>:</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(ERROR_MSG,<span class="st">'PySerial must be installed, run '</span><span class="op">+</span>BASH_TIPS[<span class="st">'GREEN'</span>]<span class="op">+</span><span class="st">'`pip3 install pyserial`'</span>,BASH_TIPS[<span class="st">'DEFAULT'</span>])</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    sys.exit(<span class="dv">1</span>)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> sys.platform <span class="op">!=</span> <span class="st">'win32'</span>:</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>        <span class="im">from</span> Crypto.Cipher <span class="im">import</span> AES</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ImportError</span>:</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(ERROR_MSG,<span class="st">'Crypto must be installed, run '</span><span class="op">+</span>BASH_TIPS[<span class="st">'GREEN'</span>]<span class="op">+</span><span class="st">'`pip3 install crypto`'</span>,BASH_TIPS[<span class="st">'DEFAULT'</span>])</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    sys.exit(<span class="dv">1</span>)</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> struct</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> enum <span class="im">import</span> Enum</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> binascii</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> hashlib</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> argparse</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time, math</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>ISP_PROG <span class="op">=</span> <span class="st">'78daedbc7b5c54d7d53fbccf7dc01b7ad4c14064e228189b5a74504824664c44d45c6a9378499b54c901d104af68306d6cc19961444da239ea60b0959828d6b6a9e9a8636312b40d62da3e4fcd45316d1ad101062f091019060d30ef5afb9ce17262f3f6f9bdcf1feffb793b7cbeacb3d7d997b5d7de7bedb5cfd967af2085a4e9bddf7e9e3f2739397f8e056047a4785842d40dec80fcad8f26ab841099813040463e40e68002641e284016800264112840968002641350801c051420470305c8fd8002e4fe4001f200a000792050803c0828e0faa89864e5140bf95b1e5e31c7fe90671bf08b8afe6a7e056559dd28af663bf2c7d85b54c142949547883c7c186363ff08f20e23f2e0c18c8d994656d80b736486a9b5a60c26d6b43b88357d02b1264f63ad293f60ad6959ac357d156b4d2ee2ad29db786bda6bbc35fd2dde9a7c52b4a67c285ad32e8ad6f416d19acc4441fa28481f05e9a3207d3f48df0fd2f783f4fd20fd00483f00d20f80f40320fd20483f08d20f82f48392929998a494c131496977c424a54f88494a9e362429e5074392d2b28624a5af1a92945c34342965dbd0a4b4d78626a5bf353429f9e4f0a4940f8727a55d1c9e94de321cd28f80f42320fd08483f02d2c741fa38481f07e9e320fded90fe76487f3ba4bf1dd22740fa04489f00e913f2c75852ae8f8949914506da878951e609a4c97e62ed0a6cff3931d1f931c3521cc945849bc0308e09450c3791611d138b58cec6700e5b11c7a530bc23a588e7263182635291c04d6644c7e422914b6524476a91c4a53126475a9189bb9b8972dc5d14c5ddc3443bee298ae6a630fd1c538afa71e94c7f477a517fee5e6680e3dea201dc5466a0636ad140ee3e6690e3bea24112e8c79d5c14234d6006bb27140d96263243dc138b8648364676db8a64298519ea4e291a2a4d6286b927150d932633c3dd938b864ba98cd99d5a6496d29858775a51ac743733c27d77d108e91ee636f73d45b749539838f794a238299d8977a717c54bf732b7bbef2dba5d9aca8c744f2d1a29ddc724b8ef2b4a80fe61c9279664a061ec27d713ed2d1e37f43577f558874f22a96238cc55b8195b4135491d8efdbcf8635b6e35b1fe2640804fe45c33b1be81d7d5daf57eb8deef26a9d28db02c85c2b6e71ae07e35f0aa89ada041bb5f91c9d0b80723d749fab5c4c80581b0f5807e8d7cb896a518a26c6d606521863459ced8aee74e4fce277362ae27d953d4909bf837495d4d24e687d88e381ea12e4c6e2121e68d8470334fdf2e4b2bc914b3c4e8f51ae901bee3f4e991b22999601da7c4c632b65c89899324622d0f9038775bd8ba572b17eb264bcd83ca5cc1b01a0c0e524aeb79ca07b91cfb32d9329700f105a2b41e052a822d10c91457955dc9ab67d56112ab9e15d8e3c50d769b7894f84bc50eeb0128e30d89ca8932723305b81e06e54ad28ae60b37b87d92a8ba8691d75fded7b5a279cfd75a1d360e8ed44135c510ad1e9943b47b3387d03a949afad4c1fa8699e923f7f67ad1b14f62c13eb1c7059f5dbe95cccfd4f3bd65c67aa2dcb40d04c22aaf88bc2adab1dd59b9603ef1c7d7747d7b7d16b6635db8aa60d85a5e2162fd50062c738ae9885d59739ec44926adfc8da8b34612291fcb4519208d96c769cc03f3dcd309eddba54a8ba09c22cde6a2ed85be614d073bc7b790a6e60bd7a02f307a5f60512e4d675218751527f56d5f47a200f2d6888ec40c4a69dbee87b62d16a97e9435e7200de8a958003d1db52bd9d0b6c341ce73223b456cb07b5d67893ff6166d8b6d593c1cda723fb66507c8d2694ddf06f3437358e5514f6718b09f608f07b3d6a12dc49c8df3caf4734dc9858b9457f8185958499a924f3c290bcd40ed0be93c236cc5eb25aa7002ae0b713c4c83ba33946f89816b3bf0cbe17a8e5d15e6c0f521b8de7a9f2aa0be4e60fca92ae40b6563fca98e549e984137d67b42d760de62e8351fbaa24a851a9f45fe9c6ebea647f715d4a32c59681be0d8b5ee97d848fd3d128d3388a699186ac036d278d27cadad2c5ade69a1baa6e6848fa0ad58b0b32cd8d9489b71a83f5a8fe4130fc11cc8409dbfafd5ff04d67f8123d5a9c93435548b325937499fab52b996af29540bfd8381bed38a7dc59a06fd44025da0ce45b4113817c4f4f419827d66e1bb8e4ccd7e58492bc1fe03323191fe83f9c8420b8d0ffdeb2697d142e3c86b87915e713a55d089b57f0b299b2f30af53ea22b47d693bbf05f3ef49621dd0425e1ff01ae4b3e7639853886332837a6464e85fd87e90ff09998f41da1e2708c4dfdfd515d1511ffdd0714058ecf3b43c5e2f0feb04b2be2e60190bffabef38a1f9bf6d1c1f7a5e62af31f481717c415ebe5ba4fb5af3212670e01b70d6f41f30e01b30d6945580c1e0536c035fe30e4e8d02dd6f02f022fa4131e007b19ecd90efe607df576ee359c897d7e75a0ee6520ee65216e65216e65206e65206e6d2886d17b05c357463d071f74db021add0b63c2973820de45bed72090fe3b50cfd2ed6e1eb07724713d91545e2c428122894886a8e62d51a893dee1c3ded78d4dd8c2dfa26f1efe43ba0af8420ef9bd6b4699cfcaa883e12d4278b83bec3c83fbcc2989f449fadff63a9df21c4371bfb2ed439f90e017c22a833d4357d30f5a3681f2b81768c827a6e16892d7a1313d72f6e54d9a64d7728bba3b09e02d453a03ec5dd50dfbba1bef7407def81fa4e81fa4e81faa633111d8bb4aed0c665ce28b0d7a90cf89c2cf665a5b64070244513afdb0d731dd44b4a265a3fe0f57ee0d4fb00b461310f6d184534db5084fdee25d5c3533d4ce1b7135bd40d72bc6417d8da8436553a74cb7cd066615e56b1a5577e7308a4f91ad270d6d12dba8dad3ee0382ad171c865ba0fe07838ee09107331846788fbb479ac9a780311de8c7d6887233c6b62112973e31cd6067665de2019ca5285285dee0baf831d6d85f2fa61796566902d31526ee66b3de54aaff52db7f817df2cf7d42f7a971b2953956246590fb60d8472daa11cb1a75e9965dc51cde661d8515dfdaac705b4aacaa38a2bc97173881cdf7914f2aa211ec8df71ea94678ab9a66f9d2c50a771f306415ffb0af21ef8cd3a483bfa96e1deae95e1da76eb328ab745cae8c97f31e67f0ded1bb4cdc7a80f5992b638264bd43ef9d03ec21c046312c6e704c62b05bbed13f707377154880cce4d6a14f4a9500df8626d74dc392a6630653566e09989f28a644a75a24d789ff1ba0e93267262699904fec45f25d1eb76a27fc0948966229bc1df980ff3c26f6a884dba0c76b502e65537936aa63231ca733538070f047f85e57c515a3949e0e304c0ef1b1b22bde705182b0c8c956edbc7ed9b41e4b541a8eb9e3659aa0dfbb7063a68d947c1f7ccc4fc33a19f4e2736771d51469e23d663e0b31e0e10acbfd7dd0afeab44d0b7b01e83f6395c03d77bba341b183380da409833704ec6f1dc44ec7370cea27d909c784c1678e43d5726e01c8ed7858f3611f2c82de68cb0157d523ad727a39e71ee1a3d65ae8bf514d0397235f5b125f0b1df001f7b4d1d891382617998c0c97305ce96f306c85941e8fa2485e9f66b1dd5e00f55431b4127d1da3ef095ba53e2c01fe164b40d4b6ac69ae7a30edc51aa2711ea0bfe4c85d6fe741eea6e7f6877ec03705f05bb2c3b414eb0d3684fb8aa1d508e8bfa48f23017b1e50421bc0fca94185b3dc8547d04cb67bc810adaf794e7426883ba56107b7f39181ad4d4fcfd164712d8086c4bcb0db46170af30da9104728792d067ef80f15c0ab668139de3e205f0912e74f6ba7fd3513d17fa7806d4b54aaf6b0d8473885cec22ea4e11ca6e83f05ab82e66bc0d705d7d96a0cf16d10b575d8f7d90f1e686e03a487cae635fa82e61a26c065d032f4e7253bba6c4822f571d0a2b856d22d88daed70b5bbfbdef6588c45b5d41fdafb8f3da98382e35dbbda120f0c1078736449df887085db2381cca0985a9ef9bb99d70b39cba7c490c37eb0d228f8802f96e00ff305c9730b6a537485c14e8cd3c8b539c922603c8d25b0ef35cf48332be407920df4f5283e1b06dedafc03e0e0aab51384f7f3fa8f90d93c28ecc4fc0d6bd0f639567b472612d36a30ed2c3781b0e3acc6d83702b5c1733b6c56d304f8a68673780eda8e7409f0ed03de88ba0be1ca04fdafea05b07e8536b7fcdf6c8929d28c501b49fd08e09d7b87d0203bedd191857b5a8b35447380cf2de803e27421f043f039f39c0fc993241d0eb73d1c664e1f8bacf57827d9761529de1b0ea8ee2b4fee9ecf43a3d2415ef89252cf5055d74ec8d83753d2c96a3189b5403636abaae9faa7f5a934398df3dda58ab9e82630dfd185847b2da5ab3e61b6bcd26cb893bf17e93858cc6b9c783cf775cc26f34de89713eb05d50dfc2eb1599c9d773f964ad2cd7a7600f5250e688bc5e77d2346b0acc95109679be13797294a5d3e674531b04639fc1f8746c1e81f1b35510753e1b19affe2d524784d71d17f9855207975a44349bc493d74d211acf6a4aeaec1d17d64b68a706407bdc7080bdc034a83359e4d147ee78dd846370e1719f5bd337ca4475ade76b3d44d34751df4820fd572417763f278075647f65643dae2f06342593ef815f3e80aebfc146ad4826e365e9d0007f6c7d17d8bbefc25a036458d8a5ee10586a63617d47ed6bca36eaaba27df4f2478812bfbddbef86fedeed63721920333f14fdcf76b411d4a7471b9df21af8d36f21bfcd318921dc24ea23dca03e2aa4a5fe3fc8e9a880b969483dab94a29f043e7f7990809d62ade5606b60ee905d125dafd1e70c9ba0fea285281b6a58b40d2877995960b03e6535d234ff6df51de85b40dee0f79c18a0c4c2fc595e8ff6ad3faed755f1cc004ce71f7ef6a6c63f84fabf79ef03e3dccaaa3fb16a41889cf4bf7b517d4e0cdfbbe9ed9dfdfdfd03d324ffb29aaec19736147ac53fd93789f80c72e7cedcc2fdc42af9c8eba20fbc2ea00250c0eb3c50c0eb1c50c0eb2c50c0eb0c50c0eb0428604321aefbd59d2e72f64575a7c0d0ffecd9179ff0a93b93885646f1864061e2cd9d8527cdb7bf3c75a77fd59fda7fe1bb7dd5dec671cef1aef175c5d79a48ade4c9c51e18b8f15ead2bf3bdbaf8d8bd3953af95644e3d933e735c87208c6f1fd7da7fc9b6c02888df442cf2de1c8707b4e549e294872552b298aba88a3efbb2b534486e14749a6fbc6cdd1f8c4e368d7241cea33ae70fbef8abcc864533b2a7bac6646d28d4c769d741d74665457365e8a0db2571609797856dae0afbfa611b0a990c88350c4764c6a815a4fcb1698347d58a75e39cd6d823c43aa20a7a03ace453008942b4351da8057ada6881bd634651065898e8a6e6ca80c74cbdb9cef80eed4a22e9b5da959b4fafd3ae7225d29edeb877119b3d8dd14a650627d6c13aa85f993318f63adf6767d78e2f19d5285e535dcefe50971f8c7332ff454b1f3d86c9124c8d603bfa15654079b5a35c9716dd9fbd379b5d2a74d7516ac61aeeb99e3eebb5abd3068b75a36ab5f571c557e95fbc98691d1d7c54955c8f41bdd2828f42ae8f9a729819db20b7fb5a4c4b8419fbe06a4fb3292f6ac60770156e7265a69f8ec88a92ea7abc9c58e75466d78ad7de9939aa715c495120d10516f986eae41f2d5cb27b7a67aa724e22bb1795fcc5b9a8aa9233f3cc806ab054fdea7ddb326663cc968db5eb5bdecac4d99b99deb716270b5c49d6443eda9a0c56228527f1a7ade97065e141dbbcaeede9a0ed0b6780cf031fec3dc0c29b722a5146fcd3a40c5cd8a8683676df251893c9ba5ff47937b77105a91d1fff4c51a02873aa6b43a1a3466046acdadbfee7e68f1a8b3bf6b7fef7b573757faffd71c7d3ed8b5b9f695e7eedb5cd13378d778e2bf9f06fbb979dfc9b0356318ebb6105081e05ccf2035d9b8b66c3ac3a9cc9287a90795031f51b3de2f20f8b7f95f163e88f5ba31549182d08c7a3d74e9bb745c9ff11f3c32da645f17943e7285d15a3a64f3fb25bf9bbd3fab92bb1b889cc1916bf68af6bb66bbf27beb629c63e421922c41cdff4aa5dc8503cd104ef34c5d49ad7d73b52a399fd65b67e657698bbecd6b457c987adbbcae97d7226bb73fe980fbf7bc0f17614711c2e2127a33acfef2f56f2cbc8df8bd317f55f579438af78b66b834779bc3c1af339f86ac9161c07d6b483e4f91b45990d2b67acd9bf467cbe61e98c67f63f233e7be9a7f7bfb0f70576fda565535d51d046a9fd4861d1eca2e9f283fd4e3ce5c352b877b194e9d3f7bbfd5103ba38d08d6991fa9c6451368a0395a5bf30c1f5cc0f4ef173fae71de777b3035e2c1b00f6d17d3bb9e239fefe764e09b61261cc717e1fcc9b927dd6dff6d35ad8470dabd7fa08ea5a0d48bc35b69574ce7fd187e5ab0f5e0d330fcb0f7e1d1ef050c9434ff8fae72d2f1e077662d15a2c7d6fae5c10f2c9b992c91a5b47e2aff167bef41c771e9e165f3bfdfd2bee2b4e25bf935c719b164d2d3ee79a0aa96ad72f98be37f7f63d0bde8f5df436689e6af755db805f746b774773fd91c4622ad7cf0fba9f0af6cfa32d3198ca160a8550b692caf83c053c5868d7827fb24afe2fc81567229400f9173c397d8adb638f5fb4e07d6cd98ceb5a4bcdf9e9139f0ef0fdddadf87fcd5c711fafae61d3a07db0758e17d7b0ace7a0d3ff60791be3731c071d1f2f214cc6c9a8b9deb2e83892735c79f03382adf963da9610f3e1f2cf3e7df7e9e2cfb1bc954f4ebfe43cee764f7bf2fdf84597a0c4b5c79f5ab5b736b1e3d1e679d78aeb66b73fd20a6bb14799e9c2ecce1fee6a1ce5dabf48ccbeb4e6fee7f73ecffee4d23359d0cadc1fa087ffca493aef563e8922ce45972b1df3a318e5859bc461be935136ce67668365deb0636fceac2dcc68392aaadfa7953d65fcb0f1c7755a39e336bdb9492febc1ce1f955c339675ffb37b9fbd55799f6ae5fdf46bad3c7701f367d7a3ae0daf464abb08a52576cc6e2faedb5bfb486ba4cca76b55e75a06e65e765c89d2e599038e59e1c952ea83d77988f2d56156b73b19df9482cd4339407b8b5469658272d9c3ab3529a42829ce6d26716633f12c06bb51dc601e284df6905c5594c2caf04f08595192a4486e313e3b366fe89296b2bd9ed22f875e2dcdc5f710a5016c65f224f83cccb44ab9663bae0a38e62fdb329540c0a4d66483c7e7e622f90f94b4124e0da6f90b52787d86127598c466af2ab3891ebb32a72aba33d595e4590ab14a960ee20e47b15a8afd838eba94e84f06c666afcfd0e3cead32792528af6e28e1eb3c39e0c31d0d0ea4f4bd60ffed4ddbafaa8b8793ed81519e18ff5b951f662af5e06d4b3e6147a52ad905908ea835efe3fa4f7cd1079c611aa71538055251a52adae7828e25bfbfa155ad19cd94b9aba5ef560ecd53668a247ec9f6a6dd57bc521d09be3bd959e43363996967454a93cf8a186794273e570d98497ca0ea882a362728171b860f70304971f392ecae19de9da78890c41d2dd1b5f2e14b8f78cc504feba47364a82283de63ae0d6d0467f5cbb89a24bbf0804df6130e5c7be5e95cd1fb5c2ed9d5d052267278b52da9fef3f58ff4e8779af911cf3d1ba7bab8948d8c12cb8f10c6a8cf4d22d34cf537d5b654a2ec16e3311f35f37af8c6cbe65c7c9e116a77801c22a7d42d26ca082e9e3b1e055ee46622ffe4fdb092fb2af14aafdad7672a0f86c6eaf34b61a1a2f935b9ebb62bebe7276e9fba45d9d3100bf31fab8df9da82cef907372942d0e2951e64943541a2244c49f03c8b4f2cbff333aea21fb9630fb6aaf560c30b4ae97cb3ba339353b68bc31dbe28e6d1ed72f650521840d96429f37907c48e5570854ca59d105aa7dd492a00ee9ad06d943b31f4dcaa83f23c0fd93643b9748a57e7e5c25ab6988b2b86f5e3f0e164a0f8c84e5910c3314f2b23aa4421b3ec5ca2dd3bbc866af4d397680e77d7349aaec53492cbe4cbe78f7c3843a93f45cac4a3c27aec07d0574e11755e35e4d920aef5016798c60901e7396969a52c405f11a1af2ca96a57e7253165c5a7a41ff8629e51c42a327471cbabfe676bba4ccb337c43b363f25a5ef56edc69577e34928b5dd2d37b639a62af503926852e517a6fa8560ec4922d4d5bae9606f6eeb41e1ace64fd41f98b89ecddb97b31f6abdd0df14bb636c55f99f5d644e71defe2488d553a53fd036b6a07bcbb2d49e46ca1c524e742bdf7a0fb9f95aedc4e69eaf6ce82f55b5c47b8c9fd49e73c65f83913b6a1f5adf94fa9c19ba4a4ea64a6d7e5b3bff9aa2bf7bd1df3b6779ad76fb1395d76bd3d7fd8395f191a24f35ccc746c0f9b3077da6b7bc66da7928e0d2dc216a3b9bd3dffacf5f026e267a7d4438fc9cbe45c99d6c3604da15d4b735795792518b5391e02f7a68778ccb930f657ef79dd37ed7fd843f31a157af2c54a472af43d7e53d7b452d7e6932f5b53be26fb6678a5cd3092b75ff5af757fae0afd183ab38c6d390ef681910343096a24b66eaf2651aae7afbbeb7e7b149ffcfaaffade04eb34049ffc8e780f7dfa713b95a15504bd524726acf25ff4750942a7cf5bbd8ffc62b34daa2245815f642a4dd5e4a05b595a0feb00c72981b82497f0facb355dfe2b812e581914ac25ef5e3de8569f7387e562b143e9a8161d5e81387eef228e4a81e12a5d8ce33d81e5de73b19c57e01cc75c9cea72f1e82373c75c61eb3b0537ad87e677580f873aadc7029dd6776a3aad87aac3d6c3b95dd66366b82f85d7fa7a97abb61590fa9bd32ab12db766bd26bd2658dfa9eef25f05890281b60d8528b7d2b00f6556032cac84dc55e4f697fccf07bbbcc5d5641bac8d3acd8e5312596fb6921a12f4b904c7a960d82561de377ce84fe2baa5f8da78e7feba3fd73ed2f168fbbcd61f36fff8daef5d51d76664372cda9f2d2ebdf4fcfd3fd9fb13f6a7979e1d9305eb8b9d07374dac6b6afe7907ac59263bc3381ba925302bf5e3c3f28d5361e5662a87f392fc755498ce4cadb91ccc4ae53709331bd72c8fba8c796e28c4b71afee5c73b94c797dab4319efbbb9867bdeeef40df514c6d445e1b084fdd61ca114a665d86be1475992823db5859e8c72a7ffa95e9ef65de92a5d3682ff415fc56bd3c82580f4f01ffd5199ee71ab549bd3182782f2f65ace929615c091ca9543e582a94aed8fd6c6953fc55ceb799788b974e5b3f43d8ec754f6194b5e7c679975ea539785dcf326a03cc23f5a5b92785792e6dce6b222b6134c04ae29abca91f73af8fc92cca746d523c62bc238587354e999d7bdb0916f4cfe1d9af2a2f4943bc5199608ddba25509a43d756348e992dd79b258129637f14c7c53e955592ae415a5daa48a2bd98fdc4ae72912bf6877637cf6ee6b304f73cac56a7e1af41f9e8d5d54ea8fcd2e0dc42e29bdea7567335867dd5eecd6ea9ccaecce766df65ece65ac8753189471e1a5e78fc42fd9dd1c9fb7bb55911a08da69c88b9b5b19bf12aeb9dded5c2ab4a09be74b3b327c7bc10381f5cb3f1ef6297f5c1a851aa272ba7806358572a3bc2acafb65352f4b2b59657d3501b91a41ae6b324abbac9a4ce321051bbf28fe627c767c7dfc92f8cbfb372f7d17a46e8ecd2b0529daa81410876b41295c3caf49e2004976775c042960fdf3518b4f79e41969775ee992880cff67657f5432cbf73f2b3be12f2d3ed4ddf71ac76df20f14aee03d5912c237ca3ef728a501e2b8db15566f7c10fef3ae0fbd281b95a9ae5ad465e26317c55e8ccd8eada7326555b3b2043eb424304395edfea1b9db03b1cf965eddeb9a87b6f5476f815e622fc7e6c57e416593a0752481fd146593782ebe65e81a087343831ffa0eba47b9d75752f94e7ee0fb73c96b5eefe5cbb497467cb1235e5cd5e313089cabadfba5ed625d53f2ca68b0df2382449fbfd5dd0f6cfb53fc89c8aa17538c773a768c61202e69e69559027972c941cf93dd6b785c01ac2f588f4f20600df0858f5a4f584b3ebf6a5473e2b5d98d8fd489ad6a488a39e81cef9c5872b4645735e65632839901b637af6f6ac7b0d10cbb66efcaff2e9e5dbc77e9fd4b135d97b233b260f5caf795a37049e77c5ce7287141d2a93dfd80d411895cb99fd2f0ccc64e1fa65841ca07476afe7bd7e4625afb0ac9496bcff5ae7d85a36fed61c54f7d99a4ab8975079d1b157c2e31de1955953e6b97bfa9367c03d7f6aa59e24eaa6a9b9bfcea4bb54d624abedc97b9fb04acbd785c7bad9fabadee716dbf6df38eeabbf2b67da04ad325c5152489d0c227eec5753c6a01d6f7440df93a51f2f83c5883d1559f9b68e192260ccb12b1802ec7e2f3e0bd2e4c5f9e45f9213311aae3e7581379fabc3cfe93f83c26e3d3eb0e33de934c932e44d68faeca92cd4ce6367fec9c05efb75476f707b4126f4aab512396f9ba4672b5f728468d88d7463526d6cdae2db9ccccc2bacd76459e5d600b4774735f23967de3822ea598be641cb47cff7589b8ee7e4c20eb9fd0568e92a9a4ba7f1ec6b17cd7a81b7217eae6ae17b655d1fbdfc1271d4db5175aacb13c69aafd79cb2c9f2663e687da73ad9fb7e11332ec77b247e2a6a989d7c456ec7f301713944dd92ac608b9b224157efa7269063e39531eae25c79e5066d7c29cbf7725bbe652f6fd4bf72ecd80baa465afafe17e052db23395b396f3a4ff3ae5bc689ab304a5deb6795775fcf4db5f4acfdbf5a7f40540b3fbaf2b9a8135eb9cef9807bdf2f620d96d5f9ba93c1d32a54a768b20d9e68788b079d25f3a0b5477e8e7b179c197cb3c12834f3d636bb155b0ed654f2aa72c9088e64dedb66ff3cf6cbc2bcf5a3e9a39f2616fad94df865a29aa6466b8a04c16ca1c57ec1f166cdb6d3ff23194e90a90273295ed011e537ed7a70644daeeebe70a3ec71f5c8c7f4b5433f707810cd86c3d3489991275f7b4a2ccc1fedd3f78f27dff424b13aea7ff5cfc48316da5ccf2ee270feb2b0fee9a12f52b7b4b253318c7c038e70868e792c0f8baa6da3d1f684f2677558f72dd9f7d6991801e40007b0693417b858bf9426fa7a391674f42c78ae6152feaeb8423f499e4cdbb578d6a4f6c9dddfcc8b5f17562c7b812cf13b8ca8b9ad0d4dc14421f716f8e33d7952b3b439d2da503b6246e9f50b87ee8445e79aa95e033b5bf05998c4b2bef5fb3770dfbfca5a57740b945dab3b6b730ed7e8f7f64b0c32b14da9177e177a0e3b820abc508bfc9418c4ef022ebedfe7fb4ddd45694c5bfd9feb4b6421bf6225d8dbcbeff705625e655b405bd726740935ef2ee7e60b66b8ad36da763a8dcfdfba6e6415f08193b2a954261246a2bb16e9cf34da778ada979c555c711984b8bf9b0fe5ec6aa86eac3b6e23612bb984b131857c9aa3265c469fe6d4fc965cec78777bdb4f599b73da5cb63bf8cb92a832ca50df8eed13ab9c6a27940d57b61957325a08fd4c0812dca28a84fe555ad1dd0e6ac68fe7e5d6c033373c745c7113eec5900f13636c6bff8d29b9e2dcf289b8645398e1533d6778631d663c7885768205b725c253beadff6c43ea3dc6e123d73b1adea4728669f689e47d79fb7517aefb9d8d22f4baf083335a96cee3612eff70f33b5cb12ac65b343bc5c934af4d56ca6d7534d62723e7c99a64c691b5a26994999c74c5e920e7a4a15b9580a6f85bc60e66b7acd27ccfc6d65cc725cef3ce593cf79c8e04c981f21b75c7ca3c8c589667dc5366ea7aaadd84aab445766dcfc24bbcd1320f1394fbdec410dbd1518b8e5cbad57b65f1efae5d9777f90a9e45443faa3c2499f8c6bfbdc6a22d7202720ae47ce308d836f2d0ba455952aacd7645cdb5fae6a976b929838a95a7a02d76bc555d04eabcafc57035dfd61bda6cd8ddd730ab6fe6fa5916841ed837a5bd0dc917d2de8a45589f56fd2996cd465f18b894ee533581dd480fd2f1709dac31de0c310fb8003c9a6c9f8dc7ff0dec5fe6942d75799f7e60a39375e8ecaddf5b2ea8315de1f31567cad2c08857796c3351f5fcb645c59343bfb60f680ac9e19586cc539b864f37867c9df54698d145f1b7fcd95197f2662edd0d63d4e92c13e82bfdab637675c09d898da3d7f67bed0e70ecbf35fb794d177cd68452a3d017c7358bdfe9d6b681b4cb5a66b601f4c74f6cd8d3ff34ae6b6bfe11c4e673613f301c6c1d4669a1a43f816d61a3b9a99e6fb86f6de94a2417b96953feb33ff447fd31fd152d1346f48264c13b3ba779a4ce9d669688a5f4b3ca648ceef9d2289ef9b02df6529972a58d53c86a40a84b5094142df9f634d2cc1ee7d88b2d01cd6f61141fc2b15ac3c6c0c81950deb7557e0bb4f6d5f5581992803253d1c43e83edcf2409ff474ff40642f9bbe87207fb4bd25ff4e7b32788fa6eb3eed9d28ac04589b54c7622f875658a13a2562c3779793dd8cb24924dc2489ee850b148a04f7bf5d2fe0937d49f4bdeac6eb1552727ecc2ccc8ff54aad2ceed5806518a3c448bcc3e726ca16894dcd24ac3c3485d8f83ac2a5f2747f8335f99befec6597d0fdce1efa1e95affbfda1feee91ee0d740a04eb71bd60ba263feee9685ef8852e7f963c743ac1f7b6b8575229061d4d72d2bd6446b9715f72f71e10174f7abfc3c47d7274bf67ca60be896cbd5f1609afed6764c04bf8fe7bb8c7ce6cc3ef0b1e68934d24469e3fcfae0e4f24eab024909de1bde2c7c4ebf2e1fe1ce2382074c86bdb98b2736e466d1b4e8eefdc4fbc0dc3c1ef023facfc6c876c4ec2bdeebccddd401c895247598d87a17b143c15740f85d512ea88138713ff48f106e44dbf594815be3347160b09eecf55872711af7816f23a3a10c26071ccd85f31dcdf1f538d7b11f93e7bf1a4665669a888c5fdc6743f459e6f38beeb55cfd6331ea893eae02e7b1d5ec89b23d8f7e2ceb988fc5c1b291b524cb8531c293b5745b01eb6c5f388ef2b18b91bbe0a97ed3c456ccfcd03de395276e12cf135003f9c00735e5b38ee423df13e07fc3d1788ada18d519f4b20717b1a88ef14c4c1fb35417a3fb5381c96c5b6b0b7a181c1fe1d670e116fdb29d0550329fb5c6070df8ddc3692e03ef5b8cf873171c345c6166a20dec560690b46821537439c2eba8fbdac6612bde713db6919b8071e755ae649656c0535747f44dcc7198c0ff7f63e2783be20cdf9b94cd9ce198cb720446ca07735144bca76ce8738b561bc8ffcb8f3390cb6894f3c11960b62b5fa9973196f48dfd775762dc85048655083c3883704bc1dc8fbce1c6fc0476c42051debf49b13fd3db6fede3a4cdba5ae22ba7bdf0f8edd5e7bbfacc9d3e81e71dcf7a3b71b0fe34ec26f56940d411ef781a5467f678e1a45b83801f7a48c215ee926dd83a08642839452188fe20ea20a8512f82b17e2a246107ffcdd9d2a8c1fba37a379cfe728d7adf6d270f73054de9ef1d9dcfd1efe7a92bd45764bbc4f24fd657301c17e6cb5405c58fe788b1b482a8c39dceb611d25814f2ad13daaa912e9af0a31bcbc3391d8c46a882f92b262e8e3a547bbd49dd534be4fb440bf8674388789e47eafbb86f5cca37ed438b8c6f7fe3cee79b01e96206d1bb491c4f84bc52e4ca74a7344ccc3919849f71829803268437fa9d4d57b4f48c4e682ad85d574058f75899b3fb77b2f9c0a46c52b8588ea49c27af447db853617f7eb4dd9b19fd8722a08eeddb19657dcca7ef34a2dda6f8105fbdd5f9e5bcfd85cd8fe47be1197ead02cb0b260e1210e2d5bb7677136a11ec66106a169938f80bf53d59d1ebfa9903d999cf2b83410daa6036c24eed580beb30decfe1d9c357d0283795f079b4fdb673be8d6590cfab7808eeb88637426e1ee04fd39a10fece459799e08f22642bbed278efd22dddb84fab35a70ef5fa1293f3533399fce19161e74c1eafbd6067bdd30be3c995457f8184e8906bb7b04ec1bce1b44a2f3860fcbe4615d326afb37e790adb392ad96d10cf43dfc868783bec742df63a1ef45e6059eeacb25e8ed55cb806e87a26ecda9d46fbd40f50bbaa2732a8e3d7780ee8d4b95a6cf7124499c1a0a84bdf53e621deba3365ee367f6f0c7f5e597ed1846f754e29e921ede185c4f032fa1b38737097805b867eceb1e5e068e39fc8ee0660f6f2ef23a21bf1b3dbc1ce47d0df9b5f7f0d6222f04f9b5f5f05cc86b82fc823dbc1dc8bb00f9b5f6f0f621af12f2bbee13815731834b0d85c3653b8ea0ddfc39da235ad78347695d2371ca7654118c276b7bdf3a7bf867492a7867b8dfb287574f52ab91b7b057bc204975232fa1a387a7d96cc8ef660f6f18b5d190df8d1ede18e075607eed3dbc49c06bc7fc423dbc0ce0a1adbc10ece1cd055e2de6d7dac3cb01de09ccef7a0f4fb3cb90df573d3c17f008e6d7dcc3db813c6cb7a61ede3ee4c1ea72e197bdf482bc5ac8ef8b5e7a41de09c8ef2af2e0ba50d70d2367a25e1736aaf8b40eec4c4fbf95def957fd56cb17c72ae9a2731ac8d6dd7e6f1cedb6015abc53b78eb7ff28ee95d5db49646e19e700c659a8f75d37db3d1e46fb704fd68d08ff9be30179c6f1803ce378409e713c20cf381eaa7bca4ec4b213be8af0bf5976f52dcaaebe45d9d5b7281b79dd6347ef87a7d848fbd131400a99081fdb31d286bdf48af235f6e4d75d97d61e5e64cc265cefe145c6e78516da4760cc69656be313f79ef5c8a38dc99e3180bcc8788c8c012ab73e1e2363007991f1181903c88b8cc7c818405e643c46c600f222e33132069017197b913180bcc8d88b8c01e445c69e3606345e64ecedb9d2c3eb1e53977b78dd63beb187d73d461b7a78dd63b4be87770479ed905f5d2f5d45c6a8bf47ff117b7be1d31e5ec4deee39ef031eb72f9344f683d36f8e928be85e70bab7bc794f29ae37707f37ee9f54f5ef17a10c8f2a6d6595c60a5364cf659c34067cba958cd21860712de7f504a09d92a09d3d5d36e847b88f3935f33ca1d7f1e06b847289b255e2b56f77f6bc6bfc3eb27b7ce2f3dbd12116c7750f4fc2efa7ba7a8559ba76d2fd0bdce31c27a1df580ef36640b33f49d4fefcacb7fde96b7b44560dae25711e1853c1820e6f7d3dae29d8be76271207f41a0cf9237307f2f05e9c6707f105c1cf770513bc411fe9651338b50dfce0a004e31dd62e77e178dfa3f7fd624e0d0621cf0cccb39996fb1b1c6f7bdab5bc61dd0c71e23cae48de83b4bc23762e92be8af886d1fbd8a7ba9087f7e33c0283717c424b6f7b82f20c02799aa93ce3a93c2d7a7983a03f69e5093de551b9dea476a009e344f2f6090c8e694e2b37d246d55cd94e17dc230cf2757975bb076ddebb6c8b8f073d5dee295be46f5976f95188b730f0cdb2453e52b6ae0f1ee344ee47caa779bc817944c6879b37ca48e5194de5a9d5ebd157d644bc9770a1979e6e2deb7e2c67cf67b7d0136fd013ff2d7a12fa943d16cb5e58d34b4fc22dcb3e80655ff8e4167a12fa969dc9ab3b058ea63f2772ddf51f45eb7f2612a76ca7c0a83bc09f3c2b70d8af22ba833534e713212df0e97ab01e655f788dda854b15937bc69cfbe1de632e622fd0ce44c65fc4be50db42c843f88cc7c04b83b502a1639ec7f279967eebb341a26b1afc16a18914ce443e962bcf1558ed7ba054585398896d6e90ae5b8cdfaac84221dbd49c10443be8a880311a0ae1de6b51e3efb91ee197d56462ddbaf4f85ff5f0a91dead0e337f7f0aba98fa1c76fd2f812c8948af335ac03cc64cadc208ea59016e7c2b59e38b944b365c85f78b587efc13c3be877e68424f594e5c63ed38afa011d8cd1f8d0b61e68b31a89c3b95dbb77c21ab98772a30cf80c19d286f4fb77e879623febd0e60649c0ef98e28461a4cc3c8ca4566d61408f0770de8fdc8f9beba2f242d9c95afa6ad4e3209cdb9b88fd7b119e2e6717c83ebe8787fa5b08694fdca5f370dc60f83b3d61ccfbc4b84818f26122e56b7ad19e75281bf13b0589daeb15e404955506592365e137ce204f22f603ec473de96bfe8df412caf115ee28fd66fac0bf993ea119d28ffc66fad0bf997ee11790feb648fac8bc148907f73f52f13b974bda1a5c1b7b99965bcd7791b4d0d787617f82f1c56ae36b4f18fb1de4ffa748bedddf8ae963963ea735054d0a1158fcd6401183d1f4f98ea49f31a2c9cf51b9f7bbe9390cd0a788dad646e2e66712b920c4e177e732bec3a8a9405f84d601c72996f79834eca38fdde2478f15846efb5892900ef9d82d7df431841fdb61fee3adc6b15656353de701dafa966551bf5bb31d8c2c255339a17c066d847f63e0a6997e9757cdd2357d9584cf58af3a12798683f898269227ca4cf305b9519648fe283ff64b5a7ff011f393ec2df4bbc321928836d36a0999f01b706568107dec34b0ef90570877fe0ef2bf2a7561580d49cdaaf60c947c5b1cfcc6cd6ae979060371edf83c0ee70ef41b22edd5d43ce892af9ac1e70e16b4373ec813bf7f44bb8dcf05fb7ecf5741bfe7a3e766a01f768bb3331cbdcecef0b6e1d9193504f58ecf1eff4fcece88d877ac8362a2dfdf6872d77e3f7cab73347ac78f407b4e8dcfa645924bb83edf11aa3c0b7e2c4b6c4ea73df25c11bf21c46f8cd412fcee9125e07611d555b50e9f3f369da9dc218b105fdc69c77c6d828b349d58f8dfcac828d1934a9f4f05b4756c66c03383eeb3bd086388c1ef39b9c4ea307d0efd667597bfb1a6cb9349e35fd0fbd56af08bc5a6da3d25d0af1a3c550bf10dee06337e3b24b856e15cd31453785753edc2b7c1cce2f761939a62ec139b624edcadbaa2e8f770308f7ca9dc1645df7f807eae68f46f97cda7f039f28c377bc56b82b4dfd36491baf4fef0357ee78edfc163fdb1eee631da776d9e31f48b950bf47b78fc561ebf89d7bf95d7bebb14616e9863968ba3e8b7ce5abaaacf9b48cc70cf9df4fd72931c15433ce3e07ad3ec0b72740ccb1d73d23d898ea3b076380a724951a44c807ee38a26715177627e43201dab3a79c67fdbac4ef39d78165149b4cac710f3383c8f68f6e76a540ceb48837c26435bb979f27128edcc63a1c967ca5cad61b007f7cb423429738e2649c92d04ecc4fd5c5a14c34d8e228fb9a54b7254142bf33cd344cef4f3ff3205e6e1ad8fc1f534d93c897892e8fbadcfe8b34daf44fb8ca3c285f697e502e0ebe0da655e90555a1b58cee76254d356fca69875c0b54d0ad9ad87eae9b324ff6d4207527c2e886b724cc335084cdc4691d8d606596f4d352b8b84533e3331dc69ec732b0579dd4ca2f026bce6d0661c2f3e455e1f5483df24defc7f950c159a0cc7ff07321c97425486290b4086fd023305ca57451339fe3f9441ebab590c3745a4fdd091348370e38a617dd90fe71f7e4af415fb1467c0ce659e2291f31be8f90e78b603f6e194554ca48f63ff75dc53cc28bc44e2f8d6b0a39aa7dfef2a9b246873ba17885176064c717c5d5879dcce4ce1a74f73f87852d60fe37950172647d5fb442916e8d80a144691ee3cb6802e2279bc123081bde0fac4110a0535944994ed127d0711b9a74cb74b783f2e9ad7e6fd5f4aa26df333e0e31646c95221f1ef0eb4a1ace81b429e6c245dd9e6afc3fe992b615ddb1ac6332594c779fa5e650a1fc273688234ed2b819b2807ce75bde5898bbe19a667061878fe99f67f911ffaa5babc1b9f61d44db7114715c4df2974a17eb0ac385ed7516180ffb7cec788bc8feb5527aca77f6621b67b073eeb06b9b7ebf6b258159bc374fec36f95774b5daa5b24bf4b0af5c7f020d23cc8ff8ad445bf373f2a50df43e6b612d93487a8a672220f2c2730f776aa5da141f4fbefd51f736552f0067d2fb4b89d2d9376dc54ceb713eb215c7f36d079648af4258b733957d5169e023e00ca0469bea6736f5e3b5cefe8a0be3ec3b459d38a4cd6946d266b323d774cb2a64d93ac293f90ace983819725e1b3137c6f6b4d390936116c6814c3aa516758399a700efcce157c056bca45d029c8b653c06fa8a3407f51a03f3cabcb04fa93407f12e84f04fd895066b4f61e600eab6c0cd2ef5f03853c5d6338328b38eb7886b5b20c0fbe41d8dabf857e1b6ab5b468df30a7035f4c667b978bfe8d32441039488b3bbbf07d119d9ffb5f6465a99c5546d68bb23b498f6b86b1124de4cd9b88757c0bab7c06eb3548877be4302ce7ba09a6c31dca4a745054a3fbe19954619817fb29fd27310a9bc1f9e3cfb6a39cb807027d5bed1ad3b5e07387362d8cfe534298b61be85c96a03d3747137f76e8a62c9e64547ac6c6c28b8ea4930c964bcb1b19fc46bda8fc43ea4d7de44fea47d4e8cd44f9442211dd70490cafcc94345942015d6fe5922c82cf161f14315fb518f3fd90e68bf65015b78a0a7b365a69dc3f50150b05853f3b44b9b4dfe427421db68d2acc61fd6cb001fac9c5def5501685d89e3a249ca57500195057b8feb25a189ebe13154f883806a9be2643f9eee104bfd3e6aa445abe3fa6aa5d7527eabce144ffd6b70dda5754a2cf0e5745bbe88f39fb77552c27d6d11ff2ca3c493b47ca7291a7e721411b82bdebcf1d8926ca027c3e7686b509e5762b0bb208451cf8212fcb22e803bfc3d6f61954407b0d81fc254584bad6edc7be053a080e043925ff6dc18f22edaae90fd712764615e7484affb360ff0b257fecd933b02e60501eeabbcf28021be4ba294f1a067efad130be73b7d5ef87f4afb1d837be55f6dd012a27ca0ffa0ad26fa25f09b0ffba3e1736e1f3686e5fcffd297dee276c83fb2d980f8695ed5a5eb856c433a6aca35ba81cf4bb6c682f948196bf8f96dfe1a88aa67a423e8e47ad3d13fee8f0819f2349da984983b2605da444d710ee9444dffbe25a418915bbfb22b4612337b948c0f318ace927b12fe03e9076ed9d66af779ce99aff6a4d790bc6f649f0d53e049feda208fd41b4a631687fa4eba3ed2de6143cabcb3911daefd78ea4e9d0e65234d6017d57ebb85032fab2d6039e64b4a3f4fa4d69bce6df66decd1dc1f7bd453c9ea1a3ed34acda8f6300fac621cc1b74b69f4b7282deeb0662de71ee50d83319f36818a73c544beb44cb191b1a47f3de2b8dc37222ef3a296fbf34b6cf3b4fedb9af897e4f8f79bf5a479f91d07c468512f13d60b7ac07a4d1788e04961d991b34b9f6eca675dd2ed1774dd6c4542ba5a33da330ad5677c9e2df2e811ddfd34ccbd9ddab9cf1a19138f650f7da1e850b1dbdf413af9ace08bdcfd3cc271877cf573defb6f573d5d28a4d9a8f290da6e77215b40fa26723544b743f0f9e312543a65a9cea91747f50ca36c2a58a12ce198e636093261783fd29961c939c02375914b949bc80fb81028526dce706f9bcc1e31a16d7aeb86e877e0bd4de7d3e814dd861dcdf7313cf83a2673fc118d4d618ae3be8b95069fa199b7856541af8fd78b6543acc5be0f7cb3cae83f7d440df64a8ef4fd30909d0afce69beff0747a9ef7f1bfafe9b12fe2ddfbf79cf47dff4fd677d447dffdbd0f7df34f27fc5f76f4ef82bfafedf76a655e40cab9e7323047ac6e4f531e4903911db79c6557d9d7415f2abc6e70cf87ecc5a1e30617b37357fbf6405d1d2cb7856a1083a2bd675acad93cab5757842235d83c0fafc5fc775edd2e22eacd7e25e68fb967cf5b87b2e6971135aff755c41d5e25eb8a0c55dd8e2b820d033b9d4f07d601bc23c9e4151f67935893b5f40ca3e0a90b8cf4324ee02acdf4353f1f98ca40e04fbb8ae9d29db00ebe99f753171dc2072fc975f12e5a510876757a983e8d914ecb7c8bb4d97b74697f7329e231bb7b0d2ae8883889c7ffd3ef981eb61d53c9578a5367aee25ead7c65da73ea94d7a1dcfcd2271b193e8f98d363c37270072427bf9efaf09cbc121442e4d439f86575e1944e70b65c3972c3df7c58914e4dbf92529f3b899b21af7349b49c467ca6c640739f53bdc127d3ee9df30a8cbb65164acc9ed44766574bf1bfb46bde858c8f8b9debe7fd6dbf71f8e1af447b5b1a9fc127ce30302491d8967e80eec8aab9909e5ad23b69f7d897a853a5433719f9f26f2ba102317fc0ce2c490b88fdbc9949170bfbd5d827c58d00d437dd8971a5975e04aad2e9bce73ff5a26e105bdbd4fe8edfd11f58fcffa40d7787e51e83efc624c8db511af6938c31d3111dc6b290f03fd9924d6e6da4fb8c99a4f5d363c15d6a1e788b5b046df676726fee15f7645f46213f6137daefa57fa59aeebe798ae9f0f7a8f35d50d8035e2f5b130deb47e724c36413e2e13d1c79f97fa2438d66af77c84630deac07b2a16a27d5daedcace87e66d43366453d2fe1b7a083cdda7b457b38f2dc88daf3b72bdea767b04ea2cf5f9e88bc33a4cf361b2bf8c8b98c68736dce2a28f330f85be8170a3d672f0a62b77dc53340d1d7a7e7bdd4269c067b49f0cc177aaea65078933edf8a164cda1c2bbd837b86b00c5f3521bdf77adaf0d9e36837ac7baab5333887f2acea9158f9719ec533ba6c756ec87fd0155fe8260b7dc2747c7e904dcd1884751d8d72615c3c37cf3bbf95a5f3404d05eb0d55b0d64375dad991875bfbce0bfa9c05eb5b6dece2de23b150c4398eb6dba13dbfd4f45778b3d73b135a1ffa2c453ba324b3f7b3149a8f50aea5affddb2fc05ece71a4ba05baef373dc4d335ef56890715cce17c6e4ece0dc558dfc133d6f019617518cf3cc36bff48a90bee33b4fc0258d7bc13e839630cf2c3f36c0eba8a663033988c1564d18069838b32b4f356f0a4174dd3b9af6f54d2976dfbd3060f9ee962b9e3f955daac9bfbeb51cde6d1e823bd7fd0e674db23df580d70164d9f5a72f109e5b6ed04bfa18a7ccb027ee908af3b8573f17ff6387ceef006cf8d4aedbb042d97ecfd1ea0aab36e5fd1163cd3e44527334b31ef62b5bbce37b4bbfc1b455b9a48ed507af7f65da4f79925f18b84a83bf80d9ecbbec8d58d4aad0e499e52659c036a9c50125025c9023a1c599ab97ee6fab9caf4465e89e6583936954c2db5a69d8e711c90260833a60c6f20dec6d3e029992758d3ce5b4a6628e68ff1ccd809735fb21eac4ec6d3efa2a481d2f6eab73d5bfcf8add953ab747d6d7da4d5f10789682721e0a908783ac28feb0e6e1abf4978903b5c92c09ce6a777a6c8bb52c8a85dca3f7972eb731894a86868a3a83b145726d3999235e2d3caf8e98ec9514c67aab2d3c3f2ef07cf7149fc8429c3cb88e33b4eb2ea652629aa69c3ced8e90e5f4982fff6821b7eb1b56356a5352d8a7c5a093edd04c7a4a8c12d2f17251505e6b936ecbc58391efe7f50d9f30c583ba5a628839901fd21b32853356de5d03f1be744af7f0a5f6887d6b79093eb1f8f036f3db243bd77fc3302c6579e1488b6d35dacd3529d8827279972a61cbf3810bf78d339eaf226574f2a22184b3931024b49746dc22f0f8762693ddf138c58751729ee686afef9d79df31531482666c4cd3d6b174a1a56e289287a1df49c6bbf29ff50cc7994ab67477eeff8cddf8c3fb86f7c3c2348eb87ce9fee5e84bd14cfdd79b189c988e841352d1aa0e7f2633c57900cc09c2097b97dce084aa2f6f3b98d8b30ddec1d1109bad3764b40a25082dd8bd6cf9dbacb9f30fa6b7c2365bdd7bd7aaa2ba3b2aff48437a6b50b7da5df9d658d0992dd39d6c1f07fd693273f9b65c52fbc1eb60e0b92cf1eb60e87eb555633fc7f3efef23b59e997773f955eff4e4efc17ef2c8b0fbeb336be53931bfceda7372a1b0a57fe3a1c3e06b80678f237e1f0fb00cb6fc3e1f6df85c3e4105c033e83ebdfbc150e1f003a2d6f69eef29c6c4bceead52b56df114d7e343de3feb9994f59962eb7ccc8cbca5f62797845760ed420c2a74ce4dd035196aeb1accd5abd06aed6e4ac5ebb72cdade3e5ad58b112ee6c250c8005700984f0f71d22024004480013200a100de807e80f7106000602060162c8566e30d021905e063a14e830c070b836036213b6921180db00718078c0ed80918004800570076014c00a180d180348042401c602ee048c037c077017e0bb80f180ef0192011300130136400a6012603220159006b81b700f600a201d702f602ae03e801d649d0672de0ff401a0d38166009d0175cd04cc04cc02cc063c087808f030e01188f37dc01cc00f008f821e1e03fa38dc9b0b79cc03cc87f002c013801f42f8478027014f017e0cbc858045802cc0d30005900dc881fb8b01b9802580a5c07b06f02c200fb00cb01cb002b012eeaf02ac06e403d6006f2de0394001601db4f0f3809f007e0a7801b01ef0b3985de4e7804240116003c00170421a17a018e086fc36024a009b009b015b002f025e02bc0cc0bf6d805792771115b01dae770076023c8052c02ec8eb5540196037e017805f02f600ca01af01f642bcd7016f00f601f6032a807f00f02bc041c0af01bf01fc16f026e077804310ef2dc0ef015ec061c011e01f05f800c7007f00bc0d380e7807f02ee03d4025e004e024e08f803f01de0754014e01aa01a7011f00fe0cf80be0af80ff02fc37e06f8033800f011f013e067c02380b329c03d400ce033e050dfd3d6117f9075c7f06f827e07368830b406b21fe45c025801f5007a8073400028046c065c015c055c035c017802f014d8066400be02bc075402b200868038400ed801b809b80af011d804e4017200c20d875b5df631a193d470f3f4e431f85c3e980c7014b002f00b602de001c03fc15500b6805983e0e87e30176c002401ea010b01d7000f00ee00ca00ed00ee8ff09d83d400a6026e049c04a8013500a5804d808f80de00ca011d00188391b0e8f06a4011e026403d601b600ca01fc394853130e9f00c4c2f561e0dd05d40e5800c8031402b6030e00de019c01cc84f87540db01fde1da027812b012900270024a01a721bf5a40fa799011b00e500a380cf804d00a88f9341c1e0b980ec8036c04bc0138016804dcf58f70780e600980ff3b840173007980ed804380bf021a01317adc458035801700a701b580b19f810e00d98076fdde0b701df399768df787fe1328201de0046c07de21c019c01c082f02acfca71637828774fa3ef0f9cfa11e803a08f3ffecb9ff905e468422d2219e05301a7017200580fd68edf22559cbb3f36046a393923e2b81cd5bb13ac792bd76d9ca7b2c63f2a30979206b6d7e8e2579dd98e40993f3d6dd65c998f34077086e93d539b93f1a933c31fba9b163f2efb4dcdb2be6bfba134dcb59fcaf6e8f1db3f8cebb2cdf7a1b7398339314925bd08eefdd9a1fa129ff37f763277dfbfdb1cb349aac53bb4e67ea74814e17e974a54ed7e974a34eb7eab45ca707747ac2103e6d089fd1e9799db6eb942cd7688c4e63756a378467ea748e4e571ac2eb0ce1424378a321bcd5102ed569b94e0f19c2c70ce11386f06943f88c217cde10ae35841b0de16643b87d795f7d92157dc3264338c6102e7d56cf4fa7870ce16386f00943f8b4217cc6103e6f08d71ac28d3a6dd6a929af6f38460fc7ea34cd10b6eb74a64e1719c24b0ce19586f03a43b8d010dea8d3ad3a3d60081f32848f19c2270ce1d386f01943f8bc215c6b08371ac2cd3a6dd769ccb2bee15843d862082f5e936c413a638e654dceb2952b5667ad5e9a938ffc0916edfe449dda749aa2d3493a9dacd3548de677e7979ff51c9863307c4bf3c122e76b93fee27c3ddfacee7859ab73d72ecb59be26ff7bab73d6ac5dbddcf25c56deda9c48fcac48fc89df88df3be2e22c5dbe2c5dbe2c5dbe2c5dbeac887cddf93c766bf9f47cf2f57cf2f57cf2f57cf223f9a4e9f46e9d4e48d6e9044d1f6991721eefd1abe581acbcbc9cd5f4be9e6e8d9e6e8d96ee2739ab57e08d9959abb3bf5bb0743548882cb23acb6241fea39a8ab2b2b357e7e483ccf92b35fe636bb294672d2b57d0d90fc2b93a3f336fc5d359793d37d6e8fcc797accec9caeec54fd6f9b712167ed01de87de80e94e6277f6f31aeeefa2af17b8b57672dcbe92506c9d7d3f58d076b12bdbc196b972b6b96ae58feedbd00e2ebf9644dfc57e9fa2680eea0c54fd1e9249d4ed669aa5e8f89b7922f9fe4ebe9f3f5f4f97afa7c3d7d7e247d9a4eefd6e984649d4ed0f4a5e7b346cf678d9ecf1a3d9f4373b571f8994e4df3f4795da78b74ba75be46dfd1e9a1057af8b16fa74f43333f4bdb23329ed6e6adb12cce59a32ce915ce5b9195ddfb7efe1a709b68782974815ce8404b97e7af59bd96aa9cf2972dcdcfd21f21f464d6974f33ed15eec9f43f7ec77ffc8efff81dffbff63be27e943cc53661598665ec98bcb577c2daec1ecbf7d7aeb1ac586c5996b36cc5eae7a321c23258183df6c4630f4c7be8212dbe6dd9fc5ef1f39fcf5f98b36ee91a8b82f354b6e5e9e72d74b537262fdb52b074cd125c63c1f24ccbe816e5cd5d9ebf76254c766bd0363d9f8fb960da7b2c59c9f78ec1155fd6049d4e447a4744a4ff673f5123bc812df40eb02cf95ffb49ff93c8dcbf1df3337dfef98d3ecfacd4e7aff82734ba46a72b7fa8d1c37abc4f747ee437f3a77abfd0e98117fadefffffa8fd1e940db7ffd3a65c8b2866b9f0ba41ff9cfef3fbffffcfef3fbcfef3fbfffdddf82f5fafa49a74b0c749d816e34d052033d60a0c70cf4b4819e37d046036d3750d3cffad258031d6ba069063ad3401718e812035d67a01b0db4d4400f18e831033d6da0e70db4d140db0dd4f4f3be34d640c71a689a81ce34d00506bac440d719e846032d35d003067acc404f1be879036d34d076033515f6a5b1063ad640d30c74a6812e30d02506bace40371a68a9811e30d063067ada40cf1b68a381b61ba8a9a82f8d35d0b1069a66a0330d7481812e31d07506bad1404b0df480811e33d0d3067ade401b0db4dd404d1bfad258031d6ba069063ad3401718e812035d67a01b0db4d4400f18e831033d6da0e70db4d140db0dd4e4e84b630d74ac81a619e84c035d60a04b0c749d816e34d052033d60a0c70cf4b4819e37d046036d375093b32f8d35d0b1069a66a0330d7481812e31d07506bad1404b0df480811e33d0d3067ade401b0db4dd404daebe34d640c71a689a81ce34d0c82f1cd6de8bc73ca73f9fd16958ff11d2fd8c41bb60bac369f4ffcb7c9ffcfe2f1b4c67a9'</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>ISP_PROG <span class="op">=</span> binascii.unhexlify(ISP_PROG)</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a><span class="co">#print('ISP_FLASH progam size (compressed)', len(ISP_PROG))</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>ISP_PROG <span class="op">=</span> zlib.decompress(ISP_PROG)</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a><span class="co">#print('ISP_FLASH progam size (decompressed)', len(ISP_PROG))</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printProgressBar (iteration, total, prefix <span class="op">=</span> <span class="st">''</span>, suffix <span class="op">=</span> <span class="st">''</span>, decimals <span class="op">=</span> <span class="dv">1</span>, length <span class="op">=</span> <span class="dv">100</span>, fill <span class="op">=</span> <span class="st">'█'</span>):</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a><span class="co">    Call in a loop to create terminal progress bar</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a><span class="co">    @params:</span></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a><span class="co">        iteration   - Required  : current iteration (Int)</span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a><span class="co">        total       - Required  : total iterations (Int)</span></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a><span class="co">        prefix      - Optional  : prefix string (Str)</span></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a><span class="co">        suffix      - Optional  : suffix string (Str)</span></span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a><span class="co">        decimals    - Optional  : positive number of decimals in percent complete (Int)</span></span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a><span class="co">        length      - Optional  : character length of bar (Int)</span></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a><span class="co">        fill        - Optional  : bar fill character (Str)</span></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>    percent <span class="op">=</span> (<span class="st">"{0:."</span> <span class="op">+</span> <span class="bu">str</span>(decimals) <span class="op">+</span> <span class="st">"f}"</span>).<span class="bu">format</span>(<span class="dv">100</span> <span class="op">*</span> (iteration <span class="op">/</span> <span class="bu">float</span>(total)))</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>    filledLength <span class="op">=</span> <span class="bu">int</span>(length <span class="op">*</span> iteration <span class="op">//</span> total)</span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>    bar <span class="op">=</span> fill <span class="op">*</span> filledLength <span class="op">+</span> <span class="st">'-'</span> <span class="op">*</span> (length <span class="op">-</span> filledLength)</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="ch">\r</span><span class="sc">%s</span><span class="st"> |</span><span class="sc">%s</span><span class="st">| </span><span class="sc">%s%%</span><span class="st"> </span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> (prefix, bar, percent, suffix), end <span class="op">=</span> <span class="st">'</span><span class="ch">\r</span><span class="st">'</span>)</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print New Line on Complete</span></span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> iteration <span class="op">==</span> total: </span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>()</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> slip_reader(port):</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>    partial_packet <span class="op">=</span> <span class="va">None</span></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>    in_escape <span class="op">=</span> <span class="va">False</span></span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>        waiting <span class="op">=</span> port.inWaiting()</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>        read_bytes <span class="op">=</span> port.read(<span class="dv">1</span> <span class="cf">if</span> waiting <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> waiting)</span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> read_bytes <span class="op">==</span> <span class="st">b''</span>:</span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">"Timed out waiting for packet </span><span class="sc">%s</span><span class="st">"</span> <span class="op">%</span> (<span class="st">"header"</span> <span class="cf">if</span> partial_packet <span class="kw">is</span> <span class="va">None</span> <span class="cf">else</span> <span class="st">"content"</span>))</span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> b <span class="kw">in</span> read_bytes:</span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">type</span>(b) <span class="kw">is</span> <span class="bu">int</span>:</span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>                b <span class="op">=</span> <span class="bu">bytes</span>([b])  <span class="co"># python 2/3 compat</span></span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> partial_packet <span class="kw">is</span> <span class="va">None</span>:  <span class="co"># waiting for packet header</span></span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> b <span class="op">==</span> <span class="st">b'</span><span class="ch">\xc0</span><span class="st">'</span>:</span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>                    partial_packet <span class="op">=</span> <span class="st">b""</span></span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">'Invalid head of packet (</span><span class="sc">%r</span><span class="st">)'</span> <span class="op">%</span> b)</span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> in_escape:  <span class="co"># part-way through escape sequence</span></span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>                in_escape <span class="op">=</span> <span class="va">False</span></span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> b <span class="op">==</span> <span class="st">b'</span><span class="ch">\xdc</span><span class="st">'</span>:</span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>                    partial_packet <span class="op">+=</span> <span class="st">b'</span><span class="ch">\xc0</span><span class="st">'</span></span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> b <span class="op">==</span> <span class="st">b'</span><span class="ch">\xdd</span><span class="st">'</span>:</span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>                    partial_packet <span class="op">+=</span> <span class="st">b'</span><span class="ch">\xdb</span><span class="st">'</span></span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">'Invalid SLIP escape (</span><span class="sc">%r%r</span><span class="st">)'</span> <span class="op">%</span> (<span class="st">b'</span><span class="ch">\xdb</span><span class="st">'</span>, b))</span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> b <span class="op">==</span> <span class="st">b'</span><span class="ch">\xdb</span><span class="st">'</span>:  <span class="co"># start of escape sequence</span></span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>                in_escape <span class="op">=</span> <span class="va">True</span></span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> b <span class="op">==</span> <span class="st">b'</span><span class="ch">\xc0</span><span class="st">'</span>:  <span class="co"># end of packet</span></span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>                <span class="cf">yield</span> partial_packet</span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a>                partial_packet <span class="op">=</span> <span class="va">None</span></span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:  <span class="co"># normal byte in packet</span></span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a>                partial_packet <span class="op">+=</span> b</span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ISPResponse:</span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> ISPOperation(Enum):</span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a>        ISP_ECHO <span class="op">=</span> <span class="bn">0xC1</span></span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a>        ISP_NOP <span class="op">=</span> <span class="bn">0xC2</span></span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a>        ISP_MEMORY_WRITE <span class="op">=</span> <span class="bn">0xC3</span></span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a>        ISP_MEMORY_READ <span class="op">=</span> <span class="bn">0xC4</span></span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a>        ISP_MEMORY_BOOT <span class="op">=</span> <span class="bn">0xC5</span></span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a>        ISP_DEBUG_INFO <span class="op">=</span> <span class="bn">0xD1</span></span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> ErrorCode(Enum):</span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a>        ISP_RET_DEFAULT <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a>        ISP_RET_OK <span class="op">=</span> <span class="bn">0xE0</span></span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a>        ISP_RET_BAD_DATA_LEN <span class="op">=</span> <span class="bn">0xE1</span></span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a>        ISP_RET_BAD_DATA_CHECKSUM <span class="op">=</span> <span class="bn">0xE2</span></span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a>        ISP_RET_INVALID_COMMAND <span class="op">=</span> <span class="bn">0xE3</span></span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse(data):</span>
<span id="cb9-125"><a href="#cb9-125" aria-hidden="true" tabindex="-1"></a>        op <span class="op">=</span> data[<span class="dv">0</span>]</span>
<span id="cb9-126"><a href="#cb9-126" aria-hidden="true" tabindex="-1"></a>        reason <span class="op">=</span> data[<span class="dv">1</span>]</span>
<span id="cb9-127"><a href="#cb9-127" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> <span class="st">''</span></span>
<span id="cb9-128"><a href="#cb9-128" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb9-129"><a href="#cb9-129" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> ISPResponse.ISPOperation(op) <span class="op">==</span> ISPResponse.ISPOperation.ISP_DEBUG_INFO:</span>
<span id="cb9-130"><a href="#cb9-130" aria-hidden="true" tabindex="-1"></a>                text <span class="op">=</span> data[<span class="dv">2</span>:].decode()</span>
<span id="cb9-131"><a href="#cb9-131" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">ValueError</span>:</span>
<span id="cb9-132"><a href="#cb9-132" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'Warning: recv unknown op'</span>, op)</span>
<span id="cb9-133"><a href="#cb9-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-134"><a href="#cb9-134" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (op, reason, text)</span>
<span id="cb9-135"><a href="#cb9-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-136"><a href="#cb9-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-137"><a href="#cb9-137" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FlashModeResponse:</span>
<span id="cb9-138"><a href="#cb9-138" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Operation(Enum):</span>
<span id="cb9-139"><a href="#cb9-139" aria-hidden="true" tabindex="-1"></a>        ISP_DEBUG_INFO <span class="op">=</span> <span class="bn">0xD1</span></span>
<span id="cb9-140"><a href="#cb9-140" aria-hidden="true" tabindex="-1"></a>        ISP_NOP <span class="op">=</span> <span class="bn">0xD2</span></span>
<span id="cb9-141"><a href="#cb9-141" aria-hidden="true" tabindex="-1"></a>        ISP_FLASH_ERASE <span class="op">=</span> <span class="bn">0xD3</span></span>
<span id="cb9-142"><a href="#cb9-142" aria-hidden="true" tabindex="-1"></a>        ISP_FLASH_WRITE <span class="op">=</span> <span class="bn">0xD4</span></span>
<span id="cb9-143"><a href="#cb9-143" aria-hidden="true" tabindex="-1"></a>        ISP_REBOOT <span class="op">=</span> <span class="bn">0xD5</span></span>
<span id="cb9-144"><a href="#cb9-144" aria-hidden="true" tabindex="-1"></a>        ISP_UARTHS_BAUDRATE_SET <span class="op">=</span> <span class="bn">0xD6</span></span>
<span id="cb9-145"><a href="#cb9-145" aria-hidden="true" tabindex="-1"></a>        FLASHMODE_FLASH_INIT <span class="op">=</span> <span class="bn">0xD7</span></span>
<span id="cb9-146"><a href="#cb9-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-147"><a href="#cb9-147" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> ErrorCode(Enum):</span>
<span id="cb9-148"><a href="#cb9-148" aria-hidden="true" tabindex="-1"></a>        ISP_RET_DEFAULT <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-149"><a href="#cb9-149" aria-hidden="true" tabindex="-1"></a>        ISP_RET_OK <span class="op">=</span> <span class="bn">0xE0</span></span>
<span id="cb9-150"><a href="#cb9-150" aria-hidden="true" tabindex="-1"></a>        ISP_RET_BAD_DATA_LEN <span class="op">=</span> <span class="bn">0xE1</span></span>
<span id="cb9-151"><a href="#cb9-151" aria-hidden="true" tabindex="-1"></a>        ISP_RET_BAD_DATA_CHECKSUM <span class="op">=</span> <span class="bn">0xE2</span></span>
<span id="cb9-152"><a href="#cb9-152" aria-hidden="true" tabindex="-1"></a>        ISP_RET_INVALID_COMMAND <span class="op">=</span> <span class="bn">0xE3</span></span>
<span id="cb9-153"><a href="#cb9-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-154"><a href="#cb9-154" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb9-155"><a href="#cb9-155" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse(data):</span>
<span id="cb9-156"><a href="#cb9-156" aria-hidden="true" tabindex="-1"></a>        op <span class="op">=</span> data[<span class="dv">0</span>]</span>
<span id="cb9-157"><a href="#cb9-157" aria-hidden="true" tabindex="-1"></a>        reason <span class="op">=</span> data[<span class="dv">1</span>]</span>
<span id="cb9-158"><a href="#cb9-158" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> <span class="st">''</span></span>
<span id="cb9-159"><a href="#cb9-159" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> FlashModeResponse.Operation(op) <span class="op">==</span> FlashModeResponse.Operation.ISP_DEBUG_INFO:</span>
<span id="cb9-160"><a href="#cb9-160" aria-hidden="true" tabindex="-1"></a>            text <span class="op">=</span> data[<span class="dv">2</span>:].decode()</span>
<span id="cb9-161"><a href="#cb9-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-162"><a href="#cb9-162" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (op, reason, text)</span>
<span id="cb9-163"><a href="#cb9-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-164"><a href="#cb9-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-165"><a href="#cb9-165" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> chunks(l, n):</span>
<span id="cb9-166"><a href="#cb9-166" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Yield successive n-sized chunks from l."""</span></span>
<span id="cb9-167"><a href="#cb9-167" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(l), n):</span>
<span id="cb9-168"><a href="#cb9-168" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> l[i:i <span class="op">+</span> n]</span>
<span id="cb9-169"><a href="#cb9-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-170"><a href="#cb9-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-171"><a href="#cb9-171" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MAIXLoader:</span>
<span id="cb9-172"><a href="#cb9-172" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> change_baudrate(<span class="va">self</span>, baudrate):</span>
<span id="cb9-173"><a href="#cb9-173" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._port <span class="op">=</span> serial.Serial(</span>
<span id="cb9-174"><a href="#cb9-174" aria-hidden="true" tabindex="-1"></a>            port<span class="op">=</span>port,</span>
<span id="cb9-175"><a href="#cb9-175" aria-hidden="true" tabindex="-1"></a>            baudrate<span class="op">=</span>baudrate,</span>
<span id="cb9-176"><a href="#cb9-176" aria-hidden="true" tabindex="-1"></a>            parity<span class="op">=</span>serial.PARITY_NONE,</span>
<span id="cb9-177"><a href="#cb9-177" aria-hidden="true" tabindex="-1"></a>            stopbits<span class="op">=</span>serial.STOPBITS_ONE,</span>
<span id="cb9-178"><a href="#cb9-178" aria-hidden="true" tabindex="-1"></a>            bytesize<span class="op">=</span>serial.EIGHTBITS,</span>
<span id="cb9-179"><a href="#cb9-179" aria-hidden="true" tabindex="-1"></a>            timeout<span class="op">=</span><span class="fl">0.1</span></span>
<span id="cb9-180"><a href="#cb9-180" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb9-181"><a href="#cb9-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-182"><a href="#cb9-182" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, port<span class="op">=</span><span class="st">'/dev/ttyUSB1'</span>, baudrate<span class="op">=</span><span class="dv">115200</span>):</span>
<span id="cb9-183"><a href="#cb9-183" aria-hidden="true" tabindex="-1"></a>        <span class="co"># configure the serial connections (the parameters differs on the device you are connecting to)</span></span>
<span id="cb9-184"><a href="#cb9-184" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._port <span class="op">=</span> serial.Serial(</span>
<span id="cb9-185"><a href="#cb9-185" aria-hidden="true" tabindex="-1"></a>            port<span class="op">=</span>port,</span>
<span id="cb9-186"><a href="#cb9-186" aria-hidden="true" tabindex="-1"></a>            baudrate<span class="op">=</span>baudrate,</span>
<span id="cb9-187"><a href="#cb9-187" aria-hidden="true" tabindex="-1"></a>            parity<span class="op">=</span>serial.PARITY_NONE,</span>
<span id="cb9-188"><a href="#cb9-188" aria-hidden="true" tabindex="-1"></a>            stopbits<span class="op">=</span>serial.STOPBITS_ONE,</span>
<span id="cb9-189"><a href="#cb9-189" aria-hidden="true" tabindex="-1"></a>            bytesize<span class="op">=</span>serial.EIGHTBITS,</span>
<span id="cb9-190"><a href="#cb9-190" aria-hidden="true" tabindex="-1"></a>            timeout<span class="op">=</span><span class="fl">0.1</span></span>
<span id="cb9-191"><a href="#cb9-191" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb9-192"><a href="#cb9-192" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(INFO_MSG,<span class="st">"Selected Baudrate: "</span>,baudrate, BASH_TIPS[<span class="st">'DEFAULT'</span>])</span>
<span id="cb9-193"><a href="#cb9-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-194"><a href="#cb9-194" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._port.isOpen()</span>
<span id="cb9-195"><a href="#cb9-195" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._slip_reader <span class="op">=</span> slip_reader(<span class="va">self</span>._port)</span>
<span id="cb9-196"><a href="#cb9-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-197"><a href="#cb9-197" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Read a SLIP packet from the serial port """</span></span>
<span id="cb9-198"><a href="#cb9-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-199"><a href="#cb9-199" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> read(<span class="va">self</span>):</span>
<span id="cb9-200"><a href="#cb9-200" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">next</span>(<span class="va">self</span>._slip_reader)</span>
<span id="cb9-201"><a href="#cb9-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-202"><a href="#cb9-202" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Write bytes to the serial port while performing SLIP escaping """</span></span>
<span id="cb9-203"><a href="#cb9-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-204"><a href="#cb9-204" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> write(<span class="va">self</span>, packet):</span>
<span id="cb9-205"><a href="#cb9-205" aria-hidden="true" tabindex="-1"></a>        buf <span class="op">=</span> <span class="st">b'</span><span class="ch">\xc0</span><span class="st">'</span> <span class="op">\</span></span>
<span id="cb9-206"><a href="#cb9-206" aria-hidden="true" tabindex="-1"></a>              <span class="op">+</span> (packet.replace(<span class="st">b'</span><span class="ch">\xdb</span><span class="st">'</span>, <span class="st">b'</span><span class="ch">\xdb\xdd</span><span class="st">'</span>).replace(<span class="st">b'</span><span class="ch">\xc0</span><span class="st">'</span>, <span class="st">b'</span><span class="ch">\xdb\xdc</span><span class="st">'</span>)) <span class="op">\</span></span>
<span id="cb9-207"><a href="#cb9-207" aria-hidden="true" tabindex="-1"></a>              <span class="op">+</span> <span class="st">b'</span><span class="ch">\xc0</span><span class="st">'</span></span>
<span id="cb9-208"><a href="#cb9-208" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print('[WRITE]', binascii.hexlify(buf))</span></span>
<span id="cb9-209"><a href="#cb9-209" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._port.write(buf)</span>
<span id="cb9-210"><a href="#cb9-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-211"><a href="#cb9-211" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> read_loop(<span class="va">self</span>):</span>
<span id="cb9-212"><a href="#cb9-212" aria-hidden="true" tabindex="-1"></a>        out <span class="op">=</span> <span class="st">b''</span></span>
<span id="cb9-213"><a href="#cb9-213" aria-hidden="true" tabindex="-1"></a>        <span class="co"># while self._port.inWaiting() &gt; 0:</span></span>
<span id="cb9-214"><a href="#cb9-214" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     out += self._port.read(1)</span></span>
<span id="cb9-215"><a href="#cb9-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-216"><a href="#cb9-216" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print(out)</span></span>
<span id="cb9-217"><a href="#cb9-217" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="dv">1</span>:</span>
<span id="cb9-218"><a href="#cb9-218" aria-hidden="true" tabindex="-1"></a>            sys.stdout.write(<span class="st">'[RECV] raw data: '</span>)</span>
<span id="cb9-219"><a href="#cb9-219" aria-hidden="true" tabindex="-1"></a>            sys.stdout.write(binascii.hexlify(<span class="va">self</span>._port.read(<span class="dv">1</span>)).decode())</span>
<span id="cb9-220"><a href="#cb9-220" aria-hidden="true" tabindex="-1"></a>            sys.stdout.flush()</span>
<span id="cb9-221"><a href="#cb9-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-222"><a href="#cb9-222" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> recv_one_return(<span class="va">self</span>):</span>
<span id="cb9-223"><a href="#cb9-223" aria-hidden="true" tabindex="-1"></a>        timeout_init <span class="op">=</span> time.time()</span>
<span id="cb9-224"><a href="#cb9-224" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> <span class="st">b''</span></span>
<span id="cb9-225"><a href="#cb9-225" aria-hidden="true" tabindex="-1"></a>        <span class="co"># find start boarder</span></span>
<span id="cb9-226"><a href="#cb9-226" aria-hidden="true" tabindex="-1"></a>        <span class="co">#sys.stdout.write('[RECV one return] raw data: ')</span></span>
<span id="cb9-227"><a href="#cb9-227" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="dv">1</span>:</span>
<span id="cb9-228"><a href="#cb9-228" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> time.time() <span class="op">-</span> timeout_init <span class="op">&gt;</span> timeout:</span>
<span id="cb9-229"><a href="#cb9-229" aria-hidden="true" tabindex="-1"></a>                <span class="cf">raise</span> <span class="pp">TimeoutError</span></span>
<span id="cb9-230"><a href="#cb9-230" aria-hidden="true" tabindex="-1"></a>            c <span class="op">=</span> <span class="va">self</span>._port.read(<span class="dv">1</span>)</span>
<span id="cb9-231"><a href="#cb9-231" aria-hidden="true" tabindex="-1"></a>            <span class="co">#sys.stdout.write(binascii.hexlify(c).decode())</span></span>
<span id="cb9-232"><a href="#cb9-232" aria-hidden="true" tabindex="-1"></a>            sys.stdout.flush()</span>
<span id="cb9-233"><a href="#cb9-233" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> c <span class="op">==</span> <span class="st">b'</span><span class="ch">\xc0</span><span class="st">'</span>:</span>
<span id="cb9-234"><a href="#cb9-234" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb9-235"><a href="#cb9-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-236"><a href="#cb9-236" aria-hidden="true" tabindex="-1"></a>        in_escape <span class="op">=</span> <span class="va">False</span></span>
<span id="cb9-237"><a href="#cb9-237" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="dv">1</span>:</span>
<span id="cb9-238"><a href="#cb9-238" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> time.time() <span class="op">-</span> timeout_init <span class="op">&gt;</span> timeout:</span>
<span id="cb9-239"><a href="#cb9-239" aria-hidden="true" tabindex="-1"></a>                <span class="cf">raise</span> <span class="pp">TimeoutError</span></span>
<span id="cb9-240"><a href="#cb9-240" aria-hidden="true" tabindex="-1"></a>            c <span class="op">=</span> <span class="va">self</span>._port.read(<span class="dv">1</span>)</span>
<span id="cb9-241"><a href="#cb9-241" aria-hidden="true" tabindex="-1"></a>            <span class="co">#sys.stdout.write(binascii.hexlify(c).decode())</span></span>
<span id="cb9-242"><a href="#cb9-242" aria-hidden="true" tabindex="-1"></a>            sys.stdout.flush()</span>
<span id="cb9-243"><a href="#cb9-243" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> c <span class="op">==</span> <span class="st">b'</span><span class="ch">\xc0</span><span class="st">'</span>:</span>
<span id="cb9-244"><a href="#cb9-244" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb9-245"><a href="#cb9-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-246"><a href="#cb9-246" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> in_escape:  <span class="co"># part-way through escape sequence</span></span>
<span id="cb9-247"><a href="#cb9-247" aria-hidden="true" tabindex="-1"></a>                in_escape <span class="op">=</span> <span class="va">False</span></span>
<span id="cb9-248"><a href="#cb9-248" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> c <span class="op">==</span> <span class="st">b'</span><span class="ch">\xdc</span><span class="st">'</span>:</span>
<span id="cb9-249"><a href="#cb9-249" aria-hidden="true" tabindex="-1"></a>                    data <span class="op">+=</span> <span class="st">b'</span><span class="ch">\xc0</span><span class="st">'</span></span>
<span id="cb9-250"><a href="#cb9-250" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> c <span class="op">==</span> <span class="st">b'</span><span class="ch">\xdd</span><span class="st">'</span>:</span>
<span id="cb9-251"><a href="#cb9-251" aria-hidden="true" tabindex="-1"></a>                    data <span class="op">+=</span> <span class="st">b'</span><span class="ch">\xdb</span><span class="st">'</span></span>
<span id="cb9-252"><a href="#cb9-252" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb9-253"><a href="#cb9-253" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">'Invalid SLIP escape (</span><span class="sc">%r%r</span><span class="st">)'</span> <span class="op">%</span> (<span class="st">b'</span><span class="ch">\xdb</span><span class="st">'</span>, b))</span>
<span id="cb9-254"><a href="#cb9-254" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> c <span class="op">==</span> <span class="st">b'</span><span class="ch">\xdb</span><span class="st">'</span>:  <span class="co"># start of escape sequence</span></span>
<span id="cb9-255"><a href="#cb9-255" aria-hidden="true" tabindex="-1"></a>                in_escape <span class="op">=</span> <span class="va">True</span></span>
<span id="cb9-256"><a href="#cb9-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-257"><a href="#cb9-257" aria-hidden="true" tabindex="-1"></a>            data <span class="op">+=</span> c</span>
<span id="cb9-258"><a href="#cb9-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-259"><a href="#cb9-259" aria-hidden="true" tabindex="-1"></a>        <span class="co">#sys.stdout.write('\n')</span></span>
<span id="cb9-260"><a href="#cb9-260" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> data</span>
<span id="cb9-261"><a href="#cb9-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-262"><a href="#cb9-262" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> reset_to_isp_kd233(<span class="va">self</span>):</span>
<span id="cb9-263"><a href="#cb9-263" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._port.dtr <span class="op">=</span> <span class="va">False</span></span>
<span id="cb9-264"><a href="#cb9-264" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._port.rts <span class="op">=</span> <span class="va">False</span></span>
<span id="cb9-265"><a href="#cb9-265" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="fl">0.01</span>)</span>
<span id="cb9-266"><a href="#cb9-266" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print('-- RESET to LOW, IO16 to HIGH --')</span></span>
<span id="cb9-267"><a href="#cb9-267" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Pull reset down and keep 10ms</span></span>
<span id="cb9-268"><a href="#cb9-268" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._port.dtr <span class="op">=</span> <span class="va">True</span></span>
<span id="cb9-269"><a href="#cb9-269" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._port.rts <span class="op">=</span> <span class="va">False</span></span>
<span id="cb9-270"><a href="#cb9-270" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="fl">0.01</span>)</span>
<span id="cb9-271"><a href="#cb9-271" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print('-- IO16 to LOW, RESET to HIGH --')</span></span>
<span id="cb9-272"><a href="#cb9-272" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Pull IO16 to low and release reset</span></span>
<span id="cb9-273"><a href="#cb9-273" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._port.rts <span class="op">=</span> <span class="va">True</span></span>
<span id="cb9-274"><a href="#cb9-274" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._port.dtr <span class="op">=</span> <span class="va">False</span></span>
<span id="cb9-275"><a href="#cb9-275" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="fl">0.01</span>)</span>
<span id="cb9-276"><a href="#cb9-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-277"><a href="#cb9-277" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> reset_to_isp_dan(<span class="va">self</span>):</span>
<span id="cb9-278"><a href="#cb9-278" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._port.dtr <span class="op">=</span> <span class="va">False</span></span>
<span id="cb9-279"><a href="#cb9-279" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._port.rts <span class="op">=</span> <span class="va">False</span></span>
<span id="cb9-280"><a href="#cb9-280" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="fl">0.01</span>)</span>
<span id="cb9-281"><a href="#cb9-281" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print('-- RESET to LOW, IO16 to HIGH --')</span></span>
<span id="cb9-282"><a href="#cb9-282" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Pull reset down and keep 10ms</span></span>
<span id="cb9-283"><a href="#cb9-283" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._port.dtr <span class="op">=</span> <span class="va">False</span></span>
<span id="cb9-284"><a href="#cb9-284" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._port.rts <span class="op">=</span> <span class="va">True</span></span>
<span id="cb9-285"><a href="#cb9-285" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="fl">0.01</span>)</span>
<span id="cb9-286"><a href="#cb9-286" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print('-- IO16 to LOW, RESET to HIGH --')</span></span>
<span id="cb9-287"><a href="#cb9-287" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Pull IO16 to low and release reset</span></span>
<span id="cb9-288"><a href="#cb9-288" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._port.rts <span class="op">=</span> <span class="va">False</span></span>
<span id="cb9-289"><a href="#cb9-289" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._port.dtr <span class="op">=</span> <span class="va">True</span></span>
<span id="cb9-290"><a href="#cb9-290" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="fl">0.01</span>)</span>
<span id="cb9-291"><a href="#cb9-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-292"><a href="#cb9-292" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> reset_to_boot(<span class="va">self</span>):</span>
<span id="cb9-293"><a href="#cb9-293" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._port.dtr <span class="op">=</span> <span class="va">False</span></span>
<span id="cb9-294"><a href="#cb9-294" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._port.rts <span class="op">=</span> <span class="va">False</span></span>
<span id="cb9-295"><a href="#cb9-295" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="fl">0.01</span>)</span>
<span id="cb9-296"><a href="#cb9-296" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print('-- RESET to LOW --')</span></span>
<span id="cb9-297"><a href="#cb9-297" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Pull reset down and keep 10ms</span></span>
<span id="cb9-298"><a href="#cb9-298" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._port.dtr <span class="op">=</span> <span class="va">True</span></span>
<span id="cb9-299"><a href="#cb9-299" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._port.rts <span class="op">=</span> <span class="va">False</span></span>
<span id="cb9-300"><a href="#cb9-300" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="fl">0.01</span>)</span>
<span id="cb9-301"><a href="#cb9-301" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print('-- RESET to HIGH, BOOT --')</span></span>
<span id="cb9-302"><a href="#cb9-302" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Pull IO16 to low and release reset</span></span>
<span id="cb9-303"><a href="#cb9-303" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._port.rts <span class="op">=</span> <span class="va">False</span></span>
<span id="cb9-304"><a href="#cb9-304" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._port.dtr <span class="op">=</span> <span class="va">False</span></span>
<span id="cb9-305"><a href="#cb9-305" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="fl">0.01</span>)</span>
<span id="cb9-306"><a href="#cb9-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-307"><a href="#cb9-307" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> greeting(<span class="va">self</span>):</span>
<span id="cb9-308"><a href="#cb9-308" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._port.write(<span class="st">b'</span><span class="ch">\xc0\xc2\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xc0</span><span class="st">'</span>)</span>
<span id="cb9-309"><a href="#cb9-309" aria-hidden="true" tabindex="-1"></a>        op, reason, text <span class="op">=</span> ISPResponse.parse(<span class="va">self</span>.recv_one_return())</span>
<span id="cb9-310"><a href="#cb9-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-311"><a href="#cb9-311" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print('MAIX return op:', ISPResponse.ISPOperation(op).name, 'reason:', ISPResponse.ErrorCode(reason).name)</span></span>
<span id="cb9-312"><a href="#cb9-312" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-313"><a href="#cb9-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-314"><a href="#cb9-314" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> flash_greeting(<span class="va">self</span>):</span>
<span id="cb9-315"><a href="#cb9-315" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="dv">1</span>:</span>
<span id="cb9-316"><a href="#cb9-316" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._port.write(<span class="st">b'</span><span class="ch">\xc0\xd2\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xc0</span><span class="st">'</span>)</span>
<span id="cb9-317"><a href="#cb9-317" aria-hidden="true" tabindex="-1"></a>            op, reason, text <span class="op">=</span> FlashModeResponse.parse(<span class="va">self</span>.recv_one_return())</span>
<span id="cb9-318"><a href="#cb9-318" aria-hidden="true" tabindex="-1"></a>            <span class="co">#print('MAIX return op:', FlashModeResponse.Operation(op).name, 'reason:',</span></span>
<span id="cb9-319"><a href="#cb9-319" aria-hidden="true" tabindex="-1"></a>            <span class="co">#      FlashModeResponse.ErrorCode(reason).name)</span></span>
<span id="cb9-320"><a href="#cb9-320" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> FlashModeResponse.Operation(op) <span class="op">==</span> FlashModeResponse.Operation.ISP_NOP:</span>
<span id="cb9-321"><a href="#cb9-321" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(INFO_MSG,<span class="st">"Boot to Flashmode Successfully"</span>,BASH_TIPS[<span class="st">'DEFAULT'</span>])</span>
<span id="cb9-322"><a href="#cb9-322" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb9-323"><a href="#cb9-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-324"><a href="#cb9-324" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'wait 1 sec'</span>)</span>
<span id="cb9-325"><a href="#cb9-325" aria-hidden="true" tabindex="-1"></a>            time.sleep(<span class="dv">1</span>)</span>
<span id="cb9-326"><a href="#cb9-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-327"><a href="#cb9-327" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> boot(<span class="va">self</span>, address<span class="op">=</span><span class="bn">0x80000000</span>):</span>
<span id="cb9-328"><a href="#cb9-328" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(INFO_MSG,<span class="st">"Booting From "</span> <span class="op">+</span> <span class="bu">hex</span>(address),BASH_TIPS[<span class="st">'DEFAULT'</span>])</span>
<span id="cb9-329"><a href="#cb9-329" aria-hidden="true" tabindex="-1"></a>        out <span class="op">=</span> struct.pack(<span class="st">'II'</span>, address, <span class="dv">0</span>)</span>
<span id="cb9-330"><a href="#cb9-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-331"><a href="#cb9-331" aria-hidden="true" tabindex="-1"></a>        crc32_checksum <span class="op">=</span> struct.pack(<span class="st">'I'</span>, binascii.crc32(out) <span class="op">&amp;</span> <span class="bn">0xFFFFFFFF</span>)</span>
<span id="cb9-332"><a href="#cb9-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-333"><a href="#cb9-333" aria-hidden="true" tabindex="-1"></a>        out <span class="op">=</span> struct.pack(<span class="st">'HH'</span>, <span class="bn">0xc5</span>, <span class="bn">0x00</span>) <span class="op">+</span> crc32_checksum <span class="op">+</span> out  <span class="co"># op: ISP_MEMORY_WRITE: 0xc3</span></span>
<span id="cb9-334"><a href="#cb9-334" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.write(out)</span>
<span id="cb9-335"><a href="#cb9-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-336"><a href="#cb9-336" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> recv_debug(<span class="va">self</span>):</span>
<span id="cb9-337"><a href="#cb9-337" aria-hidden="true" tabindex="-1"></a>        op, reason, text <span class="op">=</span> ISPResponse.parse(<span class="va">self</span>.recv_one_return())</span>
<span id="cb9-338"><a href="#cb9-338" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print('[RECV] op:', ISPResponse.ISPOperation(op).name, 'reason:', ISPResponse.ErrorCode(reason).name)</span></span>
<span id="cb9-339"><a href="#cb9-339" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> text:</span>
<span id="cb9-340"><a href="#cb9-340" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'-'</span> <span class="op">*</span> <span class="dv">30</span>)</span>
<span id="cb9-341"><a href="#cb9-341" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(text)</span>
<span id="cb9-342"><a href="#cb9-342" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'-'</span> <span class="op">*</span> <span class="dv">30</span>)</span>
<span id="cb9-343"><a href="#cb9-343" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ISPResponse.ErrorCode(reason) <span class="kw">not</span> <span class="kw">in</span> (ISPResponse.ErrorCode.ISP_RET_DEFAULT, ISPResponse.ErrorCode.ISP_RET_OK):</span>
<span id="cb9-344"><a href="#cb9-344" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'Failed, retry, errcode='</span>, <span class="bu">hex</span>(reason))</span>
<span id="cb9-345"><a href="#cb9-345" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb9-346"><a href="#cb9-346" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb9-347"><a href="#cb9-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-348"><a href="#cb9-348" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> flash_recv_debug(<span class="va">self</span>):</span>
<span id="cb9-349"><a href="#cb9-349" aria-hidden="true" tabindex="-1"></a>        op, reason, text <span class="op">=</span> FlashModeResponse.parse(<span class="va">self</span>.recv_one_return())</span>
<span id="cb9-350"><a href="#cb9-350" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print('[Flash-RECV] op:', FlashModeResponse.Operation(op).name, 'reason:',</span></span>
<span id="cb9-351"><a href="#cb9-351" aria-hidden="true" tabindex="-1"></a>        <span class="co">#      FlashModeResponse.ErrorCode(reason).name)</span></span>
<span id="cb9-352"><a href="#cb9-352" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> text:</span>
<span id="cb9-353"><a href="#cb9-353" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'-'</span> <span class="op">*</span> <span class="dv">30</span>)</span>
<span id="cb9-354"><a href="#cb9-354" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(text)</span>
<span id="cb9-355"><a href="#cb9-355" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'-'</span> <span class="op">*</span> <span class="dv">30</span>)</span>
<span id="cb9-356"><a href="#cb9-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-357"><a href="#cb9-357" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> FlashModeResponse.ErrorCode(reason) <span class="kw">not</span> <span class="kw">in</span> (FlashModeResponse.ErrorCode.ISP_RET_OK, FlashModeResponse.ErrorCode.ISP_RET_OK):</span>
<span id="cb9-358"><a href="#cb9-358" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'Failed, retry'</span>)</span>
<span id="cb9-359"><a href="#cb9-359" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb9-360"><a href="#cb9-360" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb9-361"><a href="#cb9-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-362"><a href="#cb9-362" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> init_flash(<span class="va">self</span>, chip_type):</span>
<span id="cb9-363"><a href="#cb9-363" aria-hidden="true" tabindex="-1"></a>        chip_type <span class="op">=</span> <span class="bu">int</span>(chip_type)</span>
<span id="cb9-364"><a href="#cb9-364" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(INFO_MSG,<span class="st">"Selected Flash: "</span>,(<span class="st">"In-Chip"</span>, <span class="st">"On-Board"</span>)[chip_type],BASH_TIPS[<span class="st">'DEFAULT'</span>])</span>
<span id="cb9-365"><a href="#cb9-365" aria-hidden="true" tabindex="-1"></a>        out <span class="op">=</span> struct.pack(<span class="st">'II'</span>, chip_type, <span class="dv">0</span>)</span>
<span id="cb9-366"><a href="#cb9-366" aria-hidden="true" tabindex="-1"></a>        crc32_checksum <span class="op">=</span> struct.pack(<span class="st">'I'</span>, binascii.crc32(out) <span class="op">&amp;</span> <span class="bn">0xFFFFFFFF</span>)</span>
<span id="cb9-367"><a href="#cb9-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-368"><a href="#cb9-368" aria-hidden="true" tabindex="-1"></a>        out <span class="op">=</span> struct.pack(<span class="st">'HH'</span>, <span class="bn">0xd7</span>, <span class="bn">0x00</span>) <span class="op">+</span> crc32_checksum <span class="op">+</span> out</span>
<span id="cb9-369"><a href="#cb9-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-370"><a href="#cb9-370" aria-hidden="true" tabindex="-1"></a>        sent <span class="op">=</span> <span class="va">self</span>.write(out)</span>
<span id="cb9-371"><a href="#cb9-371" aria-hidden="true" tabindex="-1"></a>        op, reason, text <span class="op">=</span> FlashModeResponse.parse(<span class="va">self</span>.recv_one_return())</span>
<span id="cb9-372"><a href="#cb9-372" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print('MAIX return op:', FlashModeResponse.Operation(op).name, 'reason:',</span></span>
<span id="cb9-373"><a href="#cb9-373" aria-hidden="true" tabindex="-1"></a>        <span class="co">#      FlashModeResponse.ErrorCode(reason).name)</span></span>
<span id="cb9-374"><a href="#cb9-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-375"><a href="#cb9-375" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> flash_dataframe(<span class="va">self</span>, data, address<span class="op">=</span><span class="bn">0x80000000</span>):</span>
<span id="cb9-376"><a href="#cb9-376" aria-hidden="true" tabindex="-1"></a>        DATAFRAME_SIZE <span class="op">=</span> <span class="dv">1024</span></span>
<span id="cb9-377"><a href="#cb9-377" aria-hidden="true" tabindex="-1"></a>        data_chunks <span class="op">=</span> chunks(data, DATAFRAME_SIZE)</span>
<span id="cb9-378"><a href="#cb9-378" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print('[DEBUG] flash dataframe | data length:', len(data))</span></span>
<span id="cb9-379"><a href="#cb9-379" aria-hidden="true" tabindex="-1"></a>        total_chunk <span class="op">=</span> math.ceil(<span class="bu">len</span>(data)<span class="op">/</span>DATAFRAME_SIZE)</span>
<span id="cb9-380"><a href="#cb9-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-381"><a href="#cb9-381" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> n, chunk <span class="kw">in</span> <span class="bu">enumerate</span>(data_chunks):</span>
<span id="cb9-382"><a href="#cb9-382" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="dv">1</span>:</span>
<span id="cb9-383"><a href="#cb9-383" aria-hidden="true" tabindex="-1"></a>                <span class="co">#print('[INFO] sending chunk', i, '@address', hex(address), 'chunklen', len(chunk))</span></span>
<span id="cb9-384"><a href="#cb9-384" aria-hidden="true" tabindex="-1"></a>                out <span class="op">=</span> struct.pack(<span class="st">'II'</span>, address, <span class="bu">len</span>(chunk))</span>
<span id="cb9-385"><a href="#cb9-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-386"><a href="#cb9-386" aria-hidden="true" tabindex="-1"></a>                crc32_checksum <span class="op">=</span> struct.pack(<span class="st">'I'</span>, binascii.crc32(out <span class="op">+</span> chunk) <span class="op">&amp;</span> <span class="bn">0xFFFFFFFF</span>)</span>
<span id="cb9-387"><a href="#cb9-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-388"><a href="#cb9-388" aria-hidden="true" tabindex="-1"></a>                out <span class="op">=</span> struct.pack(<span class="st">'HH'</span>, <span class="bn">0xc3</span>, <span class="bn">0x00</span>) <span class="op">+</span> crc32_checksum <span class="op">+</span> out <span class="op">+</span> chunk  <span class="co"># op: ISP_MEMORY_WRITE: 0xc3</span></span>
<span id="cb9-389"><a href="#cb9-389" aria-hidden="true" tabindex="-1"></a>                sent <span class="op">=</span> <span class="va">self</span>.write(out)</span>
<span id="cb9-390"><a href="#cb9-390" aria-hidden="true" tabindex="-1"></a>                <span class="co">#print('[INFO]', 'sent', sent, 'bytes', 'checksum', binascii.hexlify(crc32_checksum).decode())</span></span>
<span id="cb9-391"><a href="#cb9-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-392"><a href="#cb9-392" aria-hidden="true" tabindex="-1"></a>                address <span class="op">+=</span> <span class="bu">len</span>(chunk)</span>
<span id="cb9-393"><a href="#cb9-393" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-394"><a href="#cb9-394" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="va">self</span>.recv_debug():</span>
<span id="cb9-395"><a href="#cb9-395" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb9-396"><a href="#cb9-396" aria-hidden="true" tabindex="-1"></a>            printProgressBar(n<span class="op">+</span><span class="dv">1</span>, total_chunk, prefix <span class="op">=</span> <span class="st">'Downloading ISP:'</span>, suffix <span class="op">=</span> <span class="st">'Complete'</span>, length <span class="op">=</span> <span class="dv">50</span>)</span>
<span id="cb9-397"><a href="#cb9-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-398"><a href="#cb9-398" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dump_to_flash(<span class="va">self</span>, data, address<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb9-399"><a href="#cb9-399" aria-hidden="true" tabindex="-1"></a>        <span class="co">'''</span></span>
<span id="cb9-400"><a href="#cb9-400" aria-hidden="true" tabindex="-1"></a><span class="co">        typedef struct __attribute__((packed)) {</span></span>
<span id="cb9-401"><a href="#cb9-401" aria-hidden="true" tabindex="-1"></a><span class="co">            uint8_t op;</span></span>
<span id="cb9-402"><a href="#cb9-402" aria-hidden="true" tabindex="-1"></a><span class="co">            int32_t checksum; // 下面的所有字段都要参与checksum的计算</span></span>
<span id="cb9-403"><a href="#cb9-403" aria-hidden="true" tabindex="-1"></a><span class="co">            uint32_t address;</span></span>
<span id="cb9-404"><a href="#cb9-404" aria-hidden="true" tabindex="-1"></a><span class="co">            uint32_t data_len;</span></span>
<span id="cb9-405"><a href="#cb9-405" aria-hidden="true" tabindex="-1"></a><span class="co">            uint8_t data_buf[1024];</span></span>
<span id="cb9-406"><a href="#cb9-406" aria-hidden="true" tabindex="-1"></a><span class="co">        } isp_request_t;</span></span>
<span id="cb9-407"><a href="#cb9-407" aria-hidden="true" tabindex="-1"></a><span class="co">        '''</span></span>
<span id="cb9-408"><a href="#cb9-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-409"><a href="#cb9-409" aria-hidden="true" tabindex="-1"></a>        DATAFRAME_SIZE <span class="op">=</span> <span class="dv">4096</span></span>
<span id="cb9-410"><a href="#cb9-410" aria-hidden="true" tabindex="-1"></a>        data_chunks <span class="op">=</span> chunks(data, DATAFRAME_SIZE)</span>
<span id="cb9-411"><a href="#cb9-411" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print('[DEBUG] flash dataframe | data length:', len(data))</span></span>
<span id="cb9-412"><a href="#cb9-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-413"><a href="#cb9-413" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb9-414"><a href="#cb9-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-415"><a href="#cb9-415" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> n, chunk <span class="kw">in</span> <span class="bu">enumerate</span>(data_chunks):</span>
<span id="cb9-416"><a href="#cb9-416" aria-hidden="true" tabindex="-1"></a>            <span class="co">#print('[INFO] sending chunk', i, '@address', hex(address))</span></span>
<span id="cb9-417"><a href="#cb9-417" aria-hidden="true" tabindex="-1"></a>            out <span class="op">=</span> struct.pack(<span class="st">'II'</span>, address, <span class="bu">len</span>(chunk))</span>
<span id="cb9-418"><a href="#cb9-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-419"><a href="#cb9-419" aria-hidden="true" tabindex="-1"></a>            crc32_checksum <span class="op">=</span> struct.pack(<span class="st">'I'</span>, binascii.crc32(out <span class="op">+</span> chunk) <span class="op">&amp;</span> <span class="bn">0xFFFFFFFF</span>)</span>
<span id="cb9-420"><a href="#cb9-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-421"><a href="#cb9-421" aria-hidden="true" tabindex="-1"></a>            out <span class="op">=</span> struct.pack(<span class="st">'HH'</span>, <span class="bn">0xd4</span>, <span class="bn">0x00</span>) <span class="op">+</span> crc32_checksum <span class="op">+</span> out <span class="op">+</span> chunk</span>
<span id="cb9-422"><a href="#cb9-422" aria-hidden="true" tabindex="-1"></a>            <span class="co">#print("[$$$$]", binascii.hexlify(out[:32]).decode())</span></span>
<span id="cb9-423"><a href="#cb9-423" aria-hidden="true" tabindex="-1"></a>            sent <span class="op">=</span> <span class="va">self</span>.write(out)</span>
<span id="cb9-424"><a href="#cb9-424" aria-hidden="true" tabindex="-1"></a>            <span class="co">#print('[INFO]', 'sent', sent, 'bytes', 'checksum', crc32_checksum)</span></span>
<span id="cb9-425"><a href="#cb9-425" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.flash_recv_debug()</span>
<span id="cb9-426"><a href="#cb9-426" aria-hidden="true" tabindex="-1"></a>            address <span class="op">+=</span> <span class="bu">len</span>(chunk)</span>
<span id="cb9-427"><a href="#cb9-427" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-428"><a href="#cb9-428" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-429"><a href="#cb9-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-430"><a href="#cb9-430" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> flash_erase(<span class="va">self</span>):</span>
<span id="cb9-431"><a href="#cb9-431" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print('[DEBUG] erasing spi flash.')</span></span>
<span id="cb9-432"><a href="#cb9-432" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._port.write(<span class="st">b'</span><span class="ch">\xc0\xd3\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xc0</span><span class="st">'</span>)</span>
<span id="cb9-433"><a href="#cb9-433" aria-hidden="true" tabindex="-1"></a>        op, reason, text <span class="op">=</span> FlashModeResponse.parse(<span class="va">self</span>.recv_one_return())</span>
<span id="cb9-434"><a href="#cb9-434" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print('MAIX return op:', FlashModeResponse.Operation(op).name, 'reason:',</span></span>
<span id="cb9-435"><a href="#cb9-435" aria-hidden="true" tabindex="-1"></a>        <span class="co">#      FlashModeResponse.ErrorCode(reason).name)</span></span>
<span id="cb9-436"><a href="#cb9-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-437"><a href="#cb9-437" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> install_flash_bootloader(<span class="va">self</span>, data):</span>
<span id="cb9-438"><a href="#cb9-438" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 1. 刷入 flash bootloader</span></span>
<span id="cb9-439"><a href="#cb9-439" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.flash_dataframe(data, address<span class="op">=</span><span class="bn">0x80000000</span>)</span>
<span id="cb9-440"><a href="#cb9-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-441"><a href="#cb9-441" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> flash_firmware(<span class="va">self</span>, firmware_bin: <span class="bu">bytes</span>, aes_key: <span class="bu">bytes</span> <span class="op">=</span> <span class="va">None</span>):</span>
<span id="cb9-442"><a href="#cb9-442" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print('[DEBUG] flash_firmware DEBUG: aeskey=', aes_key)</span></span>
<span id="cb9-443"><a href="#cb9-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-444"><a href="#cb9-444" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 固件加上头</span></span>
<span id="cb9-445"><a href="#cb9-445" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 格式: SHA256(after)(32bytes) + AES_CIPHER_FLAG (1byte) + firmware_size(4bytes) + firmware_data</span></span>
<span id="cb9-446"><a href="#cb9-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-447"><a href="#cb9-447" aria-hidden="true" tabindex="-1"></a>        aes_cipher_flag <span class="op">=</span> <span class="st">b'</span><span class="ch">\x01</span><span class="st">'</span> <span class="cf">if</span> aes_key <span class="cf">else</span> <span class="st">b'</span><span class="ch">\x00</span><span class="st">'</span></span>
<span id="cb9-448"><a href="#cb9-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-449"><a href="#cb9-449" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 加密</span></span>
<span id="cb9-450"><a href="#cb9-450" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> aes_key:</span>
<span id="cb9-451"><a href="#cb9-451" aria-hidden="true" tabindex="-1"></a>            firmware_bin <span class="op">=</span> AES.new(key<span class="op">=</span>aes_key, mode<span class="op">=</span>AES.MODE_CBC, iv<span class="op">=</span><span class="st">b'</span><span class="ch">\x00</span><span class="st">'</span> <span class="op">*</span> <span class="dv">16</span>).encrypt(firmware_bin)</span>
<span id="cb9-452"><a href="#cb9-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-453"><a href="#cb9-453" aria-hidden="true" tabindex="-1"></a>        firmware_len <span class="op">=</span> <span class="bu">len</span>(firmware_bin)</span>
<span id="cb9-454"><a href="#cb9-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-455"><a href="#cb9-455" aria-hidden="true" tabindex="-1"></a>        total_chunk <span class="op">=</span> math.ceil(firmware_len<span class="op">/</span><span class="dv">4096</span>)</span>
<span id="cb9-456"><a href="#cb9-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-457"><a href="#cb9-457" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> aes_cipher_flag <span class="op">+</span> struct.pack(<span class="st">'I'</span>, firmware_len) <span class="op">+</span> firmware_bin</span>
<span id="cb9-458"><a href="#cb9-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-459"><a href="#cb9-459" aria-hidden="true" tabindex="-1"></a>        sha256_hash <span class="op">=</span> hashlib.sha256(data).digest()</span>
<span id="cb9-460"><a href="#cb9-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-461"><a href="#cb9-461" aria-hidden="true" tabindex="-1"></a>        firmware_with_header <span class="op">=</span> data <span class="op">+</span> sha256_hash</span>
<span id="cb9-462"><a href="#cb9-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-463"><a href="#cb9-463" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 3. 分片刷入固件</span></span>
<span id="cb9-464"><a href="#cb9-464" aria-hidden="true" tabindex="-1"></a>        data_chunks <span class="op">=</span> chunks(firmware_with_header, <span class="dv">4096</span>)  <span class="co"># 4kb for a sector</span></span>
<span id="cb9-465"><a href="#cb9-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-466"><a href="#cb9-466" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> n, chunk <span class="kw">in</span> <span class="bu">enumerate</span>(data_chunks):</span>
<span id="cb9-467"><a href="#cb9-467" aria-hidden="true" tabindex="-1"></a>            chunk <span class="op">=</span> chunk.ljust(<span class="dv">4096</span>, <span class="st">b'</span><span class="ch">\x00</span><span class="st">'</span>)  <span class="co"># align by 4kb</span></span>
<span id="cb9-468"><a href="#cb9-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-469"><a href="#cb9-469" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 3.1 刷入一个dataframe</span></span>
<span id="cb9-470"><a href="#cb9-470" aria-hidden="true" tabindex="-1"></a>            <span class="co">#print('[INFO]', 'Write firmware data piece')</span></span>
<span id="cb9-471"><a href="#cb9-471" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.dump_to_flash(chunk, address<span class="op">=</span>n <span class="op">*</span> <span class="dv">4096</span>)</span>
<span id="cb9-472"><a href="#cb9-472" aria-hidden="true" tabindex="-1"></a>            printProgressBar(n<span class="op">+</span><span class="dv">1</span>, total_chunk, prefix <span class="op">=</span> <span class="st">'Downloading Program:'</span>, suffix <span class="op">=</span> <span class="st">'Complete'</span>, length <span class="op">=</span> <span class="dv">50</span>)</span>
<span id="cb9-473"><a href="#cb9-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-474"><a href="#cb9-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-475"><a href="#cb9-475" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb9-476"><a href="#cb9-476" aria-hidden="true" tabindex="-1"></a>    parser <span class="op">=</span> argparse.ArgumentParser()</span>
<span id="cb9-477"><a href="#cb9-477" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">"-p"</span>, <span class="st">"--port"</span>, <span class="bu">help</span><span class="op">=</span><span class="st">"COM Port"</span>, default<span class="op">=</span><span class="st">"DEFAULT"</span>)</span>
<span id="cb9-478"><a href="#cb9-478" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">"-c"</span>, <span class="st">"--chip"</span>, <span class="bu">help</span><span class="op">=</span><span class="st">"SPI Flash type, 1 for in-chip, 0 for on-board"</span>, default<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb9-479"><a href="#cb9-479" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">"-b"</span>, <span class="st">"--baudrate"</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">int</span>, <span class="bu">help</span><span class="op">=</span><span class="st">"UART baudrate for uploading firmware"</span>, default<span class="op">=</span><span class="dv">115200</span>)</span>
<span id="cb9-480"><a href="#cb9-480" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">"-l"</span>, <span class="st">"--bootloader"</span>, <span class="bu">help</span><span class="op">=</span><span class="st">"bootloader bin path"</span>, required<span class="op">=</span><span class="va">False</span>, default<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb9-481"><a href="#cb9-481" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">"-k"</span>, <span class="st">"--key"</span>, <span class="bu">help</span><span class="op">=</span><span class="st">"AES key in hex, if you need encrypt your firmware."</span>, required<span class="op">=</span><span class="va">False</span>, default<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb9-482"><a href="#cb9-482" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">"-v"</span>, <span class="st">"--verbose"</span>, <span class="bu">help</span><span class="op">=</span><span class="st">"increase output verbosity"</span>, default<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb9-483"><a href="#cb9-483" aria-hidden="true" tabindex="-1"></a>                        action<span class="op">=</span><span class="st">"store_true"</span>)</span>
<span id="cb9-484"><a href="#cb9-484" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">"firmware"</span>, <span class="bu">help</span><span class="op">=</span><span class="st">"firmware bin path"</span>)</span>
<span id="cb9-485"><a href="#cb9-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-486"><a href="#cb9-486" aria-hidden="true" tabindex="-1"></a>    args <span class="op">=</span> parser.parse_args()</span>
<span id="cb9-487"><a href="#cb9-487" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> args.port <span class="op">==</span> <span class="st">"DEFAULT"</span>:</span>
<span id="cb9-488"><a href="#cb9-488" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb9-489"><a href="#cb9-489" aria-hidden="true" tabindex="-1"></a>            list_port_info <span class="op">=</span> <span class="bu">next</span>(serial.tools.list_ports.grep(VID_LIST_FOR_AUTO_LOOKUP)) <span class="co">#Take the first one within the list</span></span>
<span id="cb9-490"><a href="#cb9-490" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(INFO_MSG,<span class="st">"COM Port Auto Detected, Selected "</span>,list_port_info.device,BASH_TIPS[<span class="st">'DEFAULT'</span>])</span>
<span id="cb9-491"><a href="#cb9-491" aria-hidden="true" tabindex="-1"></a>            _port <span class="op">=</span> list_port_info.device</span>
<span id="cb9-492"><a href="#cb9-492" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">StopIteration</span>:</span>
<span id="cb9-493"><a href="#cb9-493" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(ERROR_MSG,<span class="st">"No vaild COM Port found in Auto Detect, Check Your Connection or Specify One by"</span><span class="op">+</span>BASH_TIPS[<span class="st">'GREEN'</span>]<span class="op">+</span><span class="st">'`--port/-p`'</span>,BASH_TIPS[<span class="st">'DEFAULT'</span>])</span>
<span id="cb9-494"><a href="#cb9-494" aria-hidden="true" tabindex="-1"></a>            sys.exit(<span class="dv">1</span>)</span>
<span id="cb9-495"><a href="#cb9-495" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb9-496"><a href="#cb9-496" aria-hidden="true" tabindex="-1"></a>        _port <span class="op">=</span> args.port</span>
<span id="cb9-497"><a href="#cb9-497" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(INFO_MSG,<span class="st">"COM Port Selected Manually: "</span>,_port,BASH_TIPS[<span class="st">'DEFAULT'</span>])</span>
<span id="cb9-498"><a href="#cb9-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-499"><a href="#cb9-499" aria-hidden="true" tabindex="-1"></a>    loader <span class="op">=</span> MAIXLoader(port<span class="op">=</span>_port, baudrate<span class="op">=</span>args.baudrate)</span>
<span id="cb9-500"><a href="#cb9-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-501"><a href="#cb9-501" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1. Greeting.</span></span>
<span id="cb9-502"><a href="#cb9-502" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(INFO_MSG,<span class="st">"Trying to Enter the ISP Mode..."</span>,BASH_TIPS[<span class="st">'DEFAULT'</span>])</span>
<span id="cb9-503"><a href="#cb9-503" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-504"><a href="#cb9-504" aria-hidden="true" tabindex="-1"></a>    retryCount <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-505"><a href="#cb9-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-506"><a href="#cb9-506" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="dv">1</span>:</span>
<span id="cb9-507"><a href="#cb9-507" aria-hidden="true" tabindex="-1"></a>        retryCount <span class="op">=</span> retryCount <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb9-508"><a href="#cb9-508" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> retryCount <span class="op">&gt;</span> <span class="dv">15</span>:</span>
<span id="cb9-509"><a href="#cb9-509" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> ERROR_MSG,<span class="st">"No vaild Kendryte K210 found in Auto Detect, Check Your Connection or Specify One by"</span><span class="op">+</span>BASH_TIPS[<span class="st">'GREEN'</span>]<span class="op">+</span><span class="st">'`-p '</span><span class="op">+</span>(<span class="st">'/dev/ttyUSB0'</span>, <span class="st">'COM3'</span>)[sys.platform <span class="op">==</span> <span class="st">'win32'</span>]<span class="op">+</span><span class="st">'`'</span>,BASH_TIPS[<span class="st">'DEFAULT'</span>])</span>
<span id="cb9-510"><a href="#cb9-510" aria-hidden="true" tabindex="-1"></a>            sys.exit(<span class="dv">1</span>)</span>
<span id="cb9-511"><a href="#cb9-511" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb9-512"><a href="#cb9-512" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'.'</span>, end<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb9-513"><a href="#cb9-513" aria-hidden="true" tabindex="-1"></a>            loader.reset_to_isp_dan()</span>
<span id="cb9-514"><a href="#cb9-514" aria-hidden="true" tabindex="-1"></a>            loader.greeting()</span>
<span id="cb9-515"><a href="#cb9-515" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb9-516"><a href="#cb9-516" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">TimeoutError</span>:</span>
<span id="cb9-517"><a href="#cb9-517" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb9-518"><a href="#cb9-518" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-519"><a href="#cb9-519" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb9-520"><a href="#cb9-520" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'_'</span>, end<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb9-521"><a href="#cb9-521" aria-hidden="true" tabindex="-1"></a>            loader.reset_to_isp_kd233()</span>
<span id="cb9-522"><a href="#cb9-522" aria-hidden="true" tabindex="-1"></a>            loader.greeting()</span>
<span id="cb9-523"><a href="#cb9-523" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb9-524"><a href="#cb9-524" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">TimeoutError</span>:</span>
<span id="cb9-525"><a href="#cb9-525" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb9-526"><a href="#cb9-526" aria-hidden="true" tabindex="-1"></a>    timeout <span class="op">=</span> <span class="dv">3</span>  </span>
<span id="cb9-527"><a href="#cb9-527" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span>
<span id="cb9-528"><a href="#cb9-528" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(INFO_MSG,<span class="st">"Greeting Message Detected, Start Downloading ISP"</span>,BASH_TIPS[<span class="st">'DEFAULT'</span>])</span>
<span id="cb9-529"><a href="#cb9-529" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2. flash bootloader and firmware</span></span>
<span id="cb9-530"><a href="#cb9-530" aria-hidden="true" tabindex="-1"></a>    firmware_bin <span class="op">=</span> <span class="bu">open</span>(args.firmware, <span class="st">'rb'</span>)</span>
<span id="cb9-531"><a href="#cb9-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-532"><a href="#cb9-532" aria-hidden="true" tabindex="-1"></a>    <span class="co"># install bootloader at 0x80000000</span></span>
<span id="cb9-533"><a href="#cb9-533" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> args.bootloader:</span>
<span id="cb9-534"><a href="#cb9-534" aria-hidden="true" tabindex="-1"></a>        loader.install_flash_bootloader(<span class="bu">open</span>(args.bootloader, <span class="st">'rb'</span>).read())</span>
<span id="cb9-535"><a href="#cb9-535" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb9-536"><a href="#cb9-536" aria-hidden="true" tabindex="-1"></a>        loader.install_flash_bootloader(ISP_PROG)</span>
<span id="cb9-537"><a href="#cb9-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-538"><a href="#cb9-538" aria-hidden="true" tabindex="-1"></a>    loader.boot()</span>
<span id="cb9-539"><a href="#cb9-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-540"><a href="#cb9-540" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(INFO_MSG,<span class="st">"Wait For 1sec for ISP to Boot"</span>,BASH_TIPS[<span class="st">'DEFAULT'</span>])</span>
<span id="cb9-541"><a href="#cb9-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-542"><a href="#cb9-542" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="dv">2</span>)</span>
<span id="cb9-543"><a href="#cb9-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-544"><a href="#cb9-544" aria-hidden="true" tabindex="-1"></a>    loader.flash_greeting()</span>
<span id="cb9-545"><a href="#cb9-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-546"><a href="#cb9-546" aria-hidden="true" tabindex="-1"></a>    loader.init_flash(args.chip)</span>
<span id="cb9-547"><a href="#cb9-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-548"><a href="#cb9-548" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> args.key:</span>
<span id="cb9-549"><a href="#cb9-549" aria-hidden="true" tabindex="-1"></a>        aes_key <span class="op">=</span> binascii.a2b_hex(args.key)</span>
<span id="cb9-550"><a href="#cb9-550" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(aes_key) <span class="op">!=</span> <span class="dv">16</span>:</span>
<span id="cb9-551"><a href="#cb9-551" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">'AES key must by 16 bytes'</span>)</span>
<span id="cb9-552"><a href="#cb9-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-553"><a href="#cb9-553" aria-hidden="true" tabindex="-1"></a>        loader.flash_firmware(firmware_bin.read(), aes_key<span class="op">=</span>aes_key)</span>
<span id="cb9-554"><a href="#cb9-554" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb9-555"><a href="#cb9-555" aria-hidden="true" tabindex="-1"></a>        loader.flash_firmware(firmware_bin.read())</span>
<span id="cb9-556"><a href="#cb9-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-557"><a href="#cb9-557" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3. boot</span></span>
<span id="cb9-558"><a href="#cb9-558" aria-hidden="true" tabindex="-1"></a>    loader.reset_to_boot()</span>
<span id="cb9-559"><a href="#cb9-559" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(INFO_MSG,<span class="st">"Rebooting..."</span>,BASH_TIPS[<span class="st">'DEFAULT'</span>])</span>
<span id="cb9-560"><a href="#cb9-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-561"><a href="#cb9-561" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb9-562"><a href="#cb9-562" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="dv">1</span>:</span>
<span id="cb9-563"><a href="#cb9-563" aria-hidden="true" tabindex="-1"></a>            out <span class="op">=</span> <span class="st">b''</span></span>
<span id="cb9-564"><a href="#cb9-564" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> loader._port.inWaiting() <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb9-565"><a href="#cb9-565" aria-hidden="true" tabindex="-1"></a>                out <span class="op">+=</span> loader._port.read(<span class="dv">1</span>)</span>
<span id="cb9-566"><a href="#cb9-566" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">""</span>.join(<span class="bu">map</span>(<span class="bu">chr</span>, out)), end<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb9-567"><a href="#cb9-567" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">KeyboardInterrupt</span>:</span>
<span id="cb9-568"><a href="#cb9-568" aria-hidden="true" tabindex="-1"></a>        sys.exit(<span class="dv">0</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/zhen8838\.github\.io");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<script src="https://utteranc.es/client.js" repo="zhen8838/zhen8838.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->




</body></html>